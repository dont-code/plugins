(self.webpackChunkplugin_tester=self.webpackChunkplugin_tester||[]).push([[4044,5861],{4044:(ae,Y,l)=>{l.r(Y),l.d(Y,{BaseAppComponent:()=>G,CHANNEL_CHANGE_NAME:()=>y,ChangeListenerService:()=>C,ChangeModule:()=>x,ChangeProviderService:()=>f,CommandModule:()=>w,DefaultViewerComponent:()=>D,DontCodeRuntimeConfig:()=>ne,GlobalPluginLoader:()=>T,IdeProject:()=>le,IndexedDbStorageService:()=>g,LayoutModule:()=>_,MainComponent:()=>H,RemotePluginLoaderService:()=>j,SANDBOX_CONFIG:()=>v,SANDBOX_MENUS:()=>S,SandboxModule:()=>E,SharedModule:()=>M,basicDocumentApiUrlConfig:()=>P,basicStoreApiUrlConfig:()=>N});var p=l(7863),e=l(549),c=l(2256),s=l(4459),V=l(4048),I=l(1738);const v=new e.InjectionToken("SandboxLibConfig"),N=i=>i.storeUrl,P=i=>i.documentUrl,y="preview-ui-changes",S=new e.InjectionToken("Allows addition of menus");var R=l(6602);class C{constructor(t,n){this.http=t,this.config=n,this.listOfChanges=[],this.changeEmitter=new c.Subject,this.connectionStatus=new c.ReplaySubject(1),this.sessionId=null,this.sessionIdSubject=new c.ReplaySubject(1);try{this.config&&this.config.webSocketUrl&&this.config.webSocketUrl.length>0?(this.previewServiceWebSocket=(0,V.webSocket)(this.config.webSocketUrl),this.connectionStatus.next("connected"),this.previewServiceWebSocket.subscribe({next:o=>{o.type===s.MessageType.CHANGE&&(o.change?(this.listOfChanges.push(o.change),this.changeEmitter.next(o.change)):console.error("Received change message without a change..."))},error:o=>{this.connectionStatus.next("ERROR:"+o),this.sessionIdSubject.next(void 0)},complete:()=>{this.connectionStatus.next("closed"),this.sessionIdSubject.next(void 0)}})):(console.warn("No SANDBOX_CONFIG WebSocketUrl injected => Not listening to changes from servers"),this.connectionStatus.next("undefined"),this.sessionIdSubject.next(void 0)),this.config&&this.config.projectUrl&&this.config.projectUrl.length>0&&(this.projectUrl=this.config.projectUrl),this.channel=new I.BroadcastChannel(y,{}),this.channel.onmessage=o=>{this.listOfChanges.push(o),this.changeEmitter.next(o)}}catch(o){console.error("Error initializing ChangeListnerService",o)}}getListOfChanges(){return this.listOfChanges}getChangeEvents(){return this.changeEmitter}getConnectionStatus(){return this.connectionStatus}setSessionId(t){this.sessionId=t,this.sessionIdSubject.next(t||void 0),this.previewServiceWebSocket&&this.previewServiceWebSocket.next(new s.Message(s.MessageType.INIT,t||void 0))}loadProject(t){if(this.sessionId)throw new Error("Cannot load a project while in a session with Builder. Please load the project ");return this.projectUrl?(0,c.firstValueFrom)(this.http.get(this.projectUrl+"/"+encodeURIComponent(t),{responseType:"json"}).pipe((0,c.map)(n=>{const o=new s.Change(s.ChangeType.RESET,"",n.content);return this.listOfChanges.push(o),this.changeEmitter.next(o),n}))):Promise.reject(new Error("Cannot call project api as No projectUrl provided in SANDBOX_CONFIG"))}getSessionId(){return this.sessionId}getSessionIdSubject(){return this.sessionIdSubject}internalPushChange(t){return this.listOfChanges.push(t),this.changeEmitter.next(t),Promise.resolve()}}C.\u0275fac=function(t){return new(t||C)(e.\u0275\u0275inject(R.HttpClient),e.\u0275\u0275inject(v,8))},C.\u0275prov=e.\u0275\u0275defineInjectable({token:C,factory:C.\u0275fac,providedIn:"root"});var u=l(3272);class f{constructor(t,n,o,r){this.changeListener=t,this.valueService=n,this.schemaManager=o,this.changeManager=r,this.subscriptions=new c.Subscription,this.changesHistory=new c.ReplaySubject,this.subscriptions.add(t.getChangeEvents().subscribe(a=>{this.pushChange(a)}))}getJsonAt(t){return this.changeManager.getJsonAt(t)}pushChange(t){this.changeManager.pushChange(t),this.changesHistory.next(t)}findAndNotify(t,n){this.changeManager.findAndNotify(t,n)}getChangesHistory(){return this.changesHistory}receiveCommands(t,n){return this.changeManager.receiveCommands(t,n)}getSchemaManager(){return this.schemaManager}calculatePointerFor(t){return this.schemaManager.generateSchemaPointer(t)}close(){this.subscriptions.unsubscribe()}}f.\u0275fac=function(t){return new(t||f)(e.\u0275\u0275inject(C),e.\u0275\u0275inject(u.ValueService),e.\u0275\u0275inject(s.DontCodeSchemaManager),e.\u0275\u0275inject(s.DontCodeChangeManager))},f.\u0275prov=e.\u0275\u0275defineInjectable({token:f,factory:f.\u0275fac,providedIn:"root"});class w{}w.\u0275fac=function(t){return new(t||w)},w.\u0275mod=e.\u0275\u0275defineNgModule({type:w}),w.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule]});class le extends s.DontCodeProject{}class x{}x.\u0275fac=function(t){return new(t||x)},x.\u0275mod=e.\u0275\u0275defineNgModule({type:x}),x.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule]});var h=l(7022),Z=l(9162);function ce(i,t){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"p"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&i){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2(" No handler found for position ",null==n.entityPointer?null:n.entityPointer.position," and schemaPosition ",null==n.entityPointer?null:n.entityPointer.positionInSchema," ")}}function de(i,t){1&i&&e.\u0275\u0275elementContainer(0)}function ue(i,t){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,de,1,0,"ng-container",8),e.\u0275\u0275elementContainerEnd()),2&i){const n=e.\u0275\u0275nextContext().$implicit,o=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngTemplateOutlet",o.subFieldFullEditTemplate(n))}}function pe(i,t){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"input",9),e.\u0275\u0275elementContainerEnd()),2&i){const n=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("name",n.name)("formControlName",n.name)}}function me(i,t){if(1&i&&(e.\u0275\u0275elementStart(0,"div",5)(1,"label",6),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",7),e.\u0275\u0275template(4,ue,2,1,"ng-container",0),e.\u0275\u0275template(5,pe,2,2,"ng-container",0),e.\u0275\u0275elementEnd()()),2&i){const n=t.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("for",n.name),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(n.name),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.component),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n.component)}}function he(i,t){1&i&&e.\u0275\u0275elementContainer(0)}function fe(i,t){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,he,1,0,"ng-container",8),e.\u0275\u0275elementContainerEnd()),2&i){const n=e.\u0275\u0275nextContext().$implicit,o=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngTemplateOutlet",o.subFieldInlineViewTemplate(n))}}function ge(i,t){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1),e.\u0275\u0275elementContainerEnd()),2&i){const n=e.\u0275\u0275nextContext().$implicit,o=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(o.getData(n.name))}}function ve(i,t){if(1&i&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275text(1),e.\u0275\u0275template(2,fe,2,1,"ng-container",0),e.\u0275\u0275template(3,ge,2,1,"ng-container",0),e.\u0275\u0275elementEnd()),2&i){const n=t.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" Value of ",n.name,": "),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.component),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n.component)}}function Ce(i,t){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"p"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"form",1)(4,"div",2),e.\u0275\u0275template(5,me,6,4,"div",3),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(8,ve,4,3,"div",4),e.\u0275\u0275elementContainerEnd()),2&i){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("You can edit the ",n.entityName," entity:"),e.\u0275\u0275advance(1),e.\u0275\u0275property("formGroup",n.form),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",n.getSubFields()),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("The values of the ",n.entityName," entity are:"),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",n.getSubFields())}}class D extends u.PluginBaseComponent{constructor(t,n,o,r,a){super(t,n,o),this.fb=r,this.storeMgr=a,this.entityName="Unknown",null==this.storeMgr&&(this.storeMgr=s.dtcde.getStoreManager(),console.warn("DontCodeStoreManager not found by Angular's Injector")),this.form=this.fb.group({},{updateOn:"blur"})}ngOnInit(){null==this.value&&(this.value={}),this.updateValueOnFormChanges()}initCommandFlow(t,n){super.initCommandFlow(t,n),this.isEntity()&&(this.decomposeJsonToMultipleChanges(n,t.getJsonAt(n.position)),this.store=this.storeMgr.getProvider(n.position),null!=this.store&&this.store.loadEntity(n.position,null).then(o=>{this.setValue(o),this.rebuildForm(),this.ref.detectChanges()},o=>{console.error("Cannot load element with DefaultViewer because of error ",o)}),this.initChangeListening(),this.rebuildForm()),this.ref.detectChanges()}handleChange(t){this.entityPointer&&(t?.pointer?.positionInSchema===s.DontCodeModel.APP_FIELDS?this.updateSubFieldsWithChange(t,"fields").then(n=>{null!=n&&(this.ref.markForCheck(),this.ref.detectChanges())}):"name"===t?.pointer?.isSubItemOf(this.entityPointer)&&(this.entityName=t.value,this.ref.markForCheck(),this.ref.detectChanges()))}canProvide(t){throw new Error("Unsupported")}providesTemplates(t){throw new Error("Unsupported")}isEntity(){return s.DontCodeModel.APP_ENTITIES===this.entityPointer?.positionInSchema}getData(t){if(this.form.controls[t])return this.form.controls[t].value}}D.\u0275fac=function(t){return new(t||D)(e.\u0275\u0275directiveInject(u.ComponentLoaderService),e.\u0275\u0275directiveInject(e.Injector),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(h.FormBuilder),e.\u0275\u0275directiveInject(s.DontCodeStoreManager))},D.\u0275cmp=e.\u0275\u0275defineComponent({type:D,selectors:[["dontcode-sandbox-default-viewer"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:3,vars:2,consts:[[4,"ngIf"],[3,"formGroup"],[1,"p-fluid"],["class","p-field p-grid",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"p-field","p-grid"],[1,"p-col-12","p-mb-2","p-md-2","p-mb-md-0",3,"for"],[1,"p-col-12","p-md-10"],[4,"ngTemplateOutlet"],["pInputText","",3,"name","formControlName"]],template:function(t,n){1&t&&(e.\u0275\u0275element(0,"dtcde-dynamic"),e.\u0275\u0275template(1,ce,3,2,"ng-container",0),e.\u0275\u0275template(2,Ce,9,5,"ng-container",0)),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n.isEntity()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.isEntity()))},dependencies:[p.NgForOf,p.NgIf,p.NgTemplateOutlet,u.DynamicInsertPoint,h.\u0275NgNoValidate,h.DefaultValueAccessor,h.NgControlStatus,h.NgControlStatusGroup,h.FormGroupDirective,h.FormControlName,Z.InputText],changeDetection:0});var be=l(3508),ye=l.n(be);class g extends s.AbstractDontCodeStoreProvider{constructor(t,n){super(),this.values=t,this.config=n,this.createDatabase()}deleteEntity(t,n){return this.ensurePositionCanBeStored(t,!1).then(o=>o.delete(n).then(()=>!0))}loadEntity(t,n){return this.ensurePositionCanBeStored(t,!1).then(o=>o.get(n))}searchEntities(t,...n){return(0,c.from)(this.ensurePositionCanBeStored(t,!0).then(o=>o.toArray().then(r=>this.applyFilters(r,...n))))}canStoreDocument(t){return!1}storeDocuments(t,n){throw new Error("Impossible to store documents in IndexedDB.")}storeEntity(t,n){return this.ensurePositionCanBeStored(t,!0).then(o=>o.put(n).then(r=>n._id&&n._id!==r?Promise.reject("Stored entity with id "+r+" different from "+n._id):n))}ensurePositionCanBeStored(t,n){const o=this.values.findAtPosition(t);return o?this.ensureEntityCanBeStored(o,n):Promise.reject("Error called with null description")}ensureEntityCanBeStored(t,n){return this.db.open().then(o=>{let r;try{r=o.table(t.name)}catch{}if(null!=r)return Promise.resolve(r);if(n){const a={};return a[t.name]="++_id",this.changeSchema(this.db,a).then(m=>(this.db=m,g.globalDb=this.db,m.table(t.name)))}return Promise.reject(t.name+" table not found")})}changeSchema(t,n){return t.close(),t.version(t.verno+1).stores(n),t.open()}createDatabase(){let t="Dont-code Sandbox Lib";this.config&&this.config.indexedDbName&&this.config.indexedDbName.length>0&&(t=this.config.indexedDbName),g.globalDb||(g.globalDb=new(ye())(t,{allowEmptyDB:!0,autoOpen:!1})),this.db=g.globalDb,this.db.open()}}g.\u0275fac=function(t){return new(t||g)(e.\u0275\u0275inject(u.ValueService),e.\u0275\u0275inject(v,8))},g.\u0275prov=e.\u0275\u0275defineInjectable({token:g,factory:g.\u0275fac,providedIn:"root"});var X=l(5861),Se=l(3630);class j{constructor(t,n,o){this.compLoader=t,this.injector=n,this.httpClient=o,this.repository=null}loadPluginsFromRepository(t,n){return void 0===t?Promise.resolve({name:"No Repository",plugins:[]}):(null==t&&(t=n),console.info("Loading plugins from repository url",t),(0,c.firstValueFrom)(this.httpClient.get(t,{observe:"body",responseType:"json"})).then(o=>{if(this.repository=o,null!=o.plugins){const r=new Array;return o.plugins.forEach(a=>{r.push(this.createRemotePluginConfig(a,n))}),console.debug("Loading following plugins",o.plugins),this.loadMultipleModules(r)}return Promise.resolve([])}).then(()=>null!=this.repository?this.repository:Promise.reject("No repository loaded")).catch(o=>(console.error("Cannot load repository config from "+t+" due to error ",o),t===n?Promise.reject(o):this.loadPluginsFromRepository(null,n))))}createRemotePluginConfig(t,n){let o;const r=t.id.substring(0,1).toUpperCase()+t.id.substring(1);return o=null!=t.info?{type:"module",moduleId:t.id,exposedModule:t.info["exposed-module"]??"./"+r,remoteEntry:t.info["remote-entry"]??n+"/remoteEntry.mjs"}:{type:"module",moduleId:t.id,exposedModule:"./"+r,remoteEntry:n+"/remoteEntry.mjs"},o}listAllRepositoryConfigUpdates(){const t=new Array;return this.repository?.plugins?.forEach(n=>{null!=n.config&&null!=n.config["definition-updates"]&&n.config["definition-updates"].forEach(o=>{t.push(o)})}),t}loadModule(t){var n=this;return(0,X.Z)(function*(){return yield(0,Se.loadRemoteModule)(t),(yield n.compLoader.getOrCreatePluginModuleRef(t.moduleId.toLowerCase())).instance})()}loadMultipleModules(t){var n=this;return(0,X.Z)(function*(){const o=new Array;for(const r of t)try{const a=yield n.loadModule(r);o.push(a)}catch(a){console.error("Error loading plugin "+r.moduleId,a)}return o})()}}j.\u0275fac=function(t){return new(t||j)(e.\u0275\u0275inject(u.ComponentLoaderService),e.\u0275\u0275inject(e.Injector),e.\u0275\u0275inject(R.HttpClient))},j.\u0275prov=e.\u0275\u0275defineInjectable({token:j,factory:j.\u0275fac,providedIn:"root"});var d=l(2369);class T{constructor(t,n,o){this.loader=t,this.changeService=n,this.previewManager=o,this.subscribers=new c.Subscriber,this.cachedHandlers=new Map}initLoading(){this.subscribers.add(this.previewManager.receiveGlobalHandlers().pipe((0,d.mergeMap)(t=>this.loader.loadPluginModule(t).then(n=>({config:t,moduleRef:n}))),(0,d.mergeMap)(t=>{const n=t.moduleRef.instance.exposedPreviewHandlers().get(t.config.class.name);return this.changeService.receiveCommands(t.config.location.parent,t.config.location.id).pipe((0,d.map)(o=>({clazz:n,moduleRef:t.moduleRef,change:o})))}),(0,d.map)(t=>{let n=this.cachedHandlers.get(t.clazz);return n||(n=t.moduleRef.injector.get(t.clazz),this.cachedHandlers.set(t.clazz,n),n.initCommandFlow(this.changeService,t.change.pointer??this.changeService.calculatePointerFor(t.change.position)),n.handleChange(t.change)),n})).subscribe({error:t=>{console.error("Error loading global handler",t)}}))}close(){this.subscribers.unsubscribe()}}T.\u0275fac=function(t){return new(t||T)(e.\u0275\u0275inject(u.ComponentLoaderService),e.\u0275\u0275inject(f),e.\u0275\u0275inject(s.DontCodePreviewManager))},T.\u0275prov=e.\u0275\u0275defineInjectable({token:T,factory:T.\u0275fac,providedIn:"root"});class M{}M.\u0275fac=function(t){return new(t||M)},M.\u0275mod=e.\u0275\u0275defineNgModule({type:M}),M.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w,x,u.PluginCommonModule,h.ReactiveFormsModule,Z.InputTextModule]});var B=l(4774),K=l(9366),q=l(2736),k=l(4504),ee=l(6956),Me=l(1411),te=l(9949),_e=l(3134);class U{constructor(t,n,o,r,a){this.provider=t,this.ref=o,this.router=r,this.ngZone=a,this.templateMenus=new Array({label:"Main Menu",items:[{label:"Home",icon:"pi pi-home",routerLink:["/"]},{label:"Dev",icon:"pi pi-book",routerLink:["dev"]}]},{label:"Application Menu",items:new Array}),this.subscriptions=new c.Subscription,this.runtime=!1;const m=window.dontCodeConfig;(!0===m?.runtime||null!=m?.projectId)&&(this.runtime=!0),null!=n&&this.templateMenus[0].items.push(...n.additionalMenus()),this.menus=this.generateMenu()}ngOnInit(){this.handleItemMenu(s.DontCodeModel.APP_ENTITIES,s.DontCodeModel.APP_ENTITIES_NAME_NODE,"pi-ticket"),this.handleItemMenu(s.DontCodeModel.APP_SCREENS,s.DontCodeModel.APP_SCREENS_NAME_NODE,"pi-desktop"),this.handleItemMenu(s.DontCodeModel.APP_REPORTS,s.DontCodeModel.APP_REPORTS_TITLE_NODE,"pi-chart-pie")}handleItemMenu(t,n,o){this.subscriptions.add(this.provider.receiveCommands(t,n).pipe((0,d.map)(r=>{this.updateMenuName(r,o),this.ref.detectChanges()})).subscribe()),this.subscriptions.add(this.provider.receiveCommands(t+"/?").pipe((0,d.map)(r=>{r.position.length>t.length+1?(this.updateMenu(r,n,o),this.ref.detectChanges()):r.value||(this.getDynamicMenu().length=0,this.ref.detectChanges())})).subscribe())}getDynamicMenu(){return this.templateMenus[1].items?this.templateMenus[1].items:[]}generateMenu(){const t=new Array;return this.runtime?(this.getDynamicMenu().forEach(n=>{t.push(n)}),0===t.length&&t.push(this.templateMenus[1])):this.templateMenus.forEach(n=>{t.push(n)}),t}ngOnDestroy(){this.subscriptions.unsubscribe()}gotoPage(t){this.ngZone.run(()=>{this.router.navigate([t])})}isActive(t){return this.router.isActive(t,!0)}cleanPosition(t){return t.endsWith(s.DontCodeModel.APP_SCREENS_NAME_NODE)&&(t=t.substring(0,t.length-s.DontCodeModel.APP_SCREENS_NAME_NODE.length-1)),t}updateMenu(t,n,o){const r=t.position,a=this.findMenuPosOf(r);let m;if(-1===a){if(null==t.value?.[n])return;m={routerLink:[r],label:t.value[n],icon:"pi "+o}}else m=this.getDynamicMenu()[a];switch(t.type){case s.ChangeType.UPDATE:case s.ChangeType.RESET:case s.ChangeType.ADD:case s.ChangeType.DELETE:break;case s.ChangeType.MOVE:{-1!==a&&this.getDynamicMenu().splice(a,1);let b=-1;t.pointer&&(b=this.findMenuPosOf(t.pointer.containerPosition+"/"+t.beforeKey)),-1!==b?this.getDynamicMenu().splice(b,0,m):this.getDynamicMenu().push(m)}this.menus=this.generateMenu()}}updateMenuName(t,n){const o=s.DontCodeModelPointer.parentPosition(t.position);if(null==o)return void console.error("Cannot update menu name for "+t.position+" with no parent position");const r=this.cleanPosition(o),a=this.findMenuPosOf(r),m=t.value;let b;switch(b=-1===a?{routerLink:[r],label:t.value,icon:"pi "+n}:this.getDynamicMenu()[a],t.type){case s.ChangeType.UPDATE:case s.ChangeType.RESET:case s.ChangeType.ADD:-1!==a?b.label=m:this.getDynamicMenu().push(b);break;case s.ChangeType.DELETE:-1!==a&&this.getDynamicMenu().splice(a,1)}this.menus=this.generateMenu()}findMenuPosOf(t){let n=-1;return this.getDynamicMenu().forEach((o,r)=>{o.routerLink[0]===t&&(n=r)}),n}}function Ee(i,t){if(1&i&&(e.\u0275\u0275elementStart(0,"div",14)(1,"div",18),e.\u0275\u0275text(2,"Server:"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",19),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",18),e.\u0275\u0275text(6,"Session:"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div",19),e.\u0275\u0275text(8),e.\u0275\u0275elementEnd()()),2&i){const n=e.\u0275\u0275nextContext().ngIf,o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(o.serverUrl),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(n.sessionId)}}U.\u0275fac=function(t){return new(t||U)(e.\u0275\u0275directiveInject(f),e.\u0275\u0275directiveInject(S,8),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(B.Router),e.\u0275\u0275directiveInject(e.NgZone))},U.\u0275cmp=e.\u0275\u0275defineComponent({type:U,selectors:[["dontcode-sandbox-menu"]],decls:2,vars:1,consts:[[1,"grid"],[1,"col",3,"model"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"p-menu",1),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("model",n.menus))},dependencies:[ee.Menu],changeDetection:0});const Ie=function(){return{width:"500px"}},Pe=function(){return{width:"15em"}};function we(i,t){if(1&i){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"p-toolbar",1)(2,"div",2)(3,"button",3),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(n);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.sidePanelVisible=!r.sidePanelVisible)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"a",4),e.\u0275\u0275element(5,"img",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"h1"),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"div",6)(9,"button",7),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(n);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.openDevUrl())}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"button",8),e.\u0275\u0275listener("mouseenter",function(r){e.\u0275\u0275restoreView(n);const a=e.\u0275\u0275reference(12);return e.\u0275\u0275resetView(a.show(r))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"p-overlayPanel",9,10),e.\u0275\u0275template(13,Ee,9,2,"ng-template",11),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(14,"div",12)(15,"p-sidebar",13),e.\u0275\u0275listener("visibleChange",function(r){e.\u0275\u0275restoreView(n);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.sidePanelVisible=r)}),e.\u0275\u0275elementStart(16,"a",4),e.\u0275\u0275element(17,"img",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(18,"dontcode-sandbox-menu"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(19,"div",14)(20,"div",15),e.\u0275\u0275element(21,"dontcode-sandbox-menu",16),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(22,"div",17),e.\u0275\u0275element(23,"router-outlet"),e.\u0275\u0275elementEnd()()()}if(2&i){const n=t.ngIf,o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(5),e.\u0275\u0275property("src",o.themedLogo(),e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(o.appName),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngClass",o.connectedClass(n)),e.\u0275\u0275advance(1),e.\u0275\u0275styleMap(e.\u0275\u0275pureFunction0(13,Ie)),e.\u0275\u0275property("showCloseIcon",!1),e.\u0275\u0275advance(4),e.\u0275\u0275styleMap(e.\u0275\u0275pureFunction0(14,Pe)),e.\u0275\u0275property("visible",o.sidePanelVisible)("modal",!1)("closeOnEscape",!0)("showCloseIcon",!0),e.\u0275\u0275advance(2),e.\u0275\u0275property("src",o.themedLogo(),e.\u0275\u0275sanitizeUrl)}}class H{constructor(t,n,o,r){this.provider=t,this.listenerService=n,this.ref=o,this.config=r,this.context$=c.EMPTY,this.subscriptions=new c.Subscription,this.appName="Plugin Tester",this.serverUrl="",this.sidePanelVisible=!0}ngOnInit(){this.config?.applicationName&&(this.appName=this.config?.applicationName),this.config&&this.config.webSocketUrl&&this.config.webSocketUrl.length>0&&(this.serverUrl=this.config.webSocketUrl),this.subscriptions.add(this.provider.receiveCommands(s.DontCodeModel.APP_NAME).subscribe(t=>{this.appName=this.generateApplicationName(t.value?t.value:"No Name"),this.ref.detectChanges()})),this.context$=(0,c.combineLatest)([this.listenerService.getConnectionStatus(),this.listenerService.getSessionIdSubject()]).pipe((0,d.map)(t=>({status:t[0],sessionId:t[1]})))}ngOnDestroy(){this.subscriptions.unsubscribe()}logoClicked(){this.sidePanelVisible=!0}sidePanelVisibleChanged(t){this.sidePanelVisible=t.target.visible}openDevUrl(){window.open("#/newTabDev","_blank")}connectedClass(t){return"undefined"===t.status?"p-button-secondary":"connected"!==t.status?"p-button-danger":""}generateApplicationName(t){return this.config?.applicationName?this.config?.applicationName+" "+t:t}themedLogo(){return this.config?.theme?"assets/images/logo-"+this.config?.theme+".png":"assets/images/logo.png"}}H.\u0275fac=function(t){return new(t||H)(e.\u0275\u0275directiveInject(f),e.\u0275\u0275directiveInject(C),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(v,8))},H.\u0275cmp=e.\u0275\u0275defineComponent({type:H,selectors:[["dontcode-sandbox-main"]],decls:2,vars:3,consts:[[4,"ngIf"],["id","mainToolbar"],[1,"p-toolbar-group-left"],["pButton","","type","button","icon","pi pi-bars",1,"md:hidden","p-button-rounded","p-button-outlined",2,"margin-right","10px",3,"click"],["href","https://dont-code.net/apps.html"],["width","119","height","66",3,"src"],[1,"p-toolbar-group-right"],["pButton","","type","button","icon","pi pi-external-link",1,"p-button-rounded","p-button-outlined",3,"click"],["pButton","","type","button","icon","pi pi-sort",1,"p-button-rounded","p-button-outlined",3,"ngClass","mouseenter"],[3,"showCloseIcon"],["op",""],["pTemplate",""],[1,"md:hidden"],["id","mainSidePanel",3,"visible","modal","closeOnEscape","showCloseIcon","visibleChange"],[1,"grid"],[1,"col","hidden","md:block","md:col-3"],["id","mainMenu"],[1,"col","md:col-9"],[1,"col-2"],[1,"col-10"]],template:function(t,n){1&t&&(e.\u0275\u0275template(0,we,24,15,"div",0),e.\u0275\u0275pipe(1,"async")),2&t&&e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(1,1,n.context$))},dependencies:[p.NgClass,p.NgIf,B.RouterOutlet,K.Sidebar,q.Toolbar,k.ButtonDirective,te.OverlayPanel,_e.PrimeTemplate,U,p.AsyncPipe],styles:[".sidenav-container[_ngcontent-%COMP%]{height:100%}.sidenav[_ngcontent-%COMP%]{width:200px}.sidenav[_ngcontent-%COMP%]   .mat-toolbar[_ngcontent-%COMP%]{background:inherit}.mat-toolbar.mat-primary[_ngcontent-%COMP%]{position:sticky;top:0;z-index:1}"],changeDetection:0});class G{constructor(t,n,o,r,a,m,b,Ne,Ae,Oe,Fe,Le){this.provider=t,this.storage=n,this.listener=o,this.pluginLoader=r,this.globalPluginLoader=a,this.loaderService=m,this.changeProviderService=b,this.injector=Ne,this.dontCodeCore=Ae,this.modelMgr=Oe,this.storeMgr=Fe,this.previewMgr=Le,this.subscription=new c.Subscription,this.sessionId=null,this.runtimeConfig=new ne}ngOnInit(){this.pluginsLoaded=this.pluginLoader.loadPluginsFromRepository(this.runtimeConfig.repositoryUrl,"assets/repositories/default.json").catch(n=>this.runtimeConfig.forceRepositoryLoading?Promise.reject(n):Promise.resolve(null)).then(n=>{this.dontCodeCore.initPlugins(),this.pluginLoader.listAllRepositoryConfigUpdates().forEach(r=>{const a=this.modelMgr.convertToChange(r);this.changeProviderService.pushChange(a)}),console.info("Dynamic Plugins inited"),this.globalPluginLoader.initLoading(),this.storeMgr.setProvider(this.storage),this.subscription.add(this.provider.receiveCommands(s.DontCodeModel.APP_SHARING,s.DontCodeModel.APP_SHARING_WITH_NODE).pipe((0,d.mergeMap)(r=>r.type!==s.ChangeType.DELETE?"No-one"===r.value?(this.storeMgr.setProvider(this.storage),c.EMPTY):r.value?this.loadStoreManager(s.DontCodeModel.APP_SHARING_WITH):c.EMPTY:c.EMPTY),(0,d.map)(r=>{if(null!=r){const a=e.Injector.create({providers:[r],parent:this.injector});this.storeMgr.setProvider(a.get(r)),console.info("Set new provider to:",r)}return r})).subscribe({error(r){console.error("Cannot load StoreProvider due to",r)}})),this.sessionId=this.runtimeConfig.sessionId??null,console.info("Browser opened with SessionId =",this.sessionId),this.listener.setSessionId(this.sessionId)})}loadStoreManager(t){const n=this.provider.getJsonAt(t),o=this.previewMgr.retrieveHandlerConfig(t,n);return o?(console.debug("Importing StoreManager from ",o.class.source),this.loaderService.loadPluginModule(o).then(r=>{const a=r.instance.exposedPreviewHandlers().get(o.class.name);return console.debug("Provider Class found:",a),a})):Promise.reject("No handler found for storemanager "+n)}mainTab(){return-1===window.location.hash.indexOf("/newTabDev")}ngOnDestroy(){this.subscription.unsubscribe()}}G.\u0275fac=function(t){return new(t||G)(e.\u0275\u0275directiveInject(f),e.\u0275\u0275directiveInject(g),e.\u0275\u0275directiveInject(C),e.\u0275\u0275directiveInject(j),e.\u0275\u0275directiveInject(T),e.\u0275\u0275directiveInject(u.ComponentLoaderService),e.\u0275\u0275directiveInject(f),e.\u0275\u0275directiveInject(e.Injector),e.\u0275\u0275directiveInject(u.DONT_CODE_CORE),e.\u0275\u0275directiveInject(s.DontCodeModelManager),e.\u0275\u0275directiveInject(s.DontCodeStoreManager),e.\u0275\u0275directiveInject(s.DontCodePreviewManager))},G.\u0275cmp=e.\u0275\u0275defineComponent({type:G,selectors:[["ng-component"]],decls:0,vars:0,template:function(t,n){},encapsulation:2});class ne{constructor(){this.runtime=!1,this.forceRepositoryLoading=!1}}class _{}_.\u0275fac=function(t){return new(t||_)},_.\u0275mod=e.\u0275\u0275defineNgModule({type:_}),_.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,B.RouterModule,K.SidebarModule,q.ToolbarModule,k.ButtonModule,ee.MenuModule,Me.TooltipModule,te.OverlayPanelModule]});var Q=l(7981),oe=l(7471),xe=l(7822),ie=l(178),re=l(6674);class A{}A.\u0275fac=function(t){return new(t||A)},A.\u0275mod=e.\u0275\u0275defineNgModule({type:A}),A.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,M,Q.AccordionModule,oe.AutoCompleteModule,xe.PanelModule,Z.InputTextModule,h.ReactiveFormsModule,ie.InputTextareaModule,k.ButtonModule,re.DropdownModule,u.PluginCommonModule]});class z{}function De(i,t){if(1&i&&(e.\u0275\u0275elementStart(0,"p"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"json"),e.\u0275\u0275elementEnd()),2&i){const n=t.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate3("",n.type,", ",n.position,", ",e.\u0275\u0275pipeBind1(2,3,n.value?n.value:n.beforeKey),"")}}z.\u0275fac=function(t){return new(t||z)},z.\u0275cmp=e.\u0275\u0275defineComponent({type:z,selectors:[["dontcode-sandbox-home"]],decls:24,vars:0,consts:[["pButton","","type","button","icon","pi pi-sort",1,"p-button-rounded","p-button-outlined","p-button-secondary"],["pButton","","type","button","icon","pi pi-sort",1,"p-button-rounded","p-button-outlined","p-button-danger"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"h1"),e.\u0275\u0275text(1,"Welcome to DontCode !"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(2,"h2"),e.\u0275\u0275text(3,"What am I seeing ?"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"p"),e.\u0275\u0275text(5,"You have opened the Preview App. The Preview App connects to Online services to receive Application changes from the Application Builder in realtime."),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p")(7,"b"),e.\u0275\u0275text(8,"Check you are connected"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(9," to the online service by looking at the "),e.\u0275\u0275element(10,"button",0),e.\u0275\u0275text(11," icon in the header panel."),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"p"),e.\u0275\u0275element(13,"button",0),e.\u0275\u0275text(14," means you are ok, "),e.\u0275\u0275element(15,"button",1),e.\u0275\u0275text(16," you have connection issue to the online service. Please check the browser log in this case"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"p"),e.\u0275\u0275text(18,"If "),e.\u0275\u0275element(19,"button",0),e.\u0275\u0275text(20,", then "),e.\u0275\u0275elementStart(21,"b"),e.\u0275\u0275text(22,"go back to the Application Builder"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(23," and enter some values in the Editor"),e.\u0275\u0275elementEnd())},dependencies:[k.ButtonDirective],styles:["button[_ngcontent-%COMP%]{vertical-align:middle}"]});class W{constructor(t,n){this.changeProvider=t,this.ref=n,this.subscriptions=new c.Subscription,this.commands=[],this.forgetIt=!0}ngOnInit(){this.subscriptions.add(this.changeProvider.getChangesHistory().pipe((0,d.map)(t=>{this.commands.push(t),this.ref.detectChanges()})).subscribe())}noCommands(){return 0==this.commands.length}ngOnDestroy(){this.subscriptions.unsubscribe()}}W.\u0275fac=function(t){return new(t||W)(e.\u0275\u0275directiveInject(f),e.\u0275\u0275directiveInject(e.ChangeDetectorRef))},W.\u0275cmp=e.\u0275\u0275defineComponent({type:W,selectors:[["dontcode-sandbox-list-commands"]],decls:3,vars:1,consts:[[4,"ngFor","ngForOf"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"p"),e.\u0275\u0275text(1,"We list below the commands received from the Application Builder:"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(2,De,3,5,"p",0)),2&t&&(e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",n.commands))},dependencies:[p.NgForOf,p.JsonPipe],changeDetection:0});class O{constructor(t){this.listener=t,this.channel=new I.BroadcastChannel(y)}pushChange(t){return this.listener.internalPushChange(t)}}O.\u0275fac=function(t){return new(t||O)(e.\u0275\u0275inject(C))},O.\u0275prov=e.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac,providedIn:"root"});class F{constructor(t,n){this.http=t,this.config=n,this.templates=[]}getTemplates(){if(this.templates.length>0)return(0,c.of)(this.templates);{let t=this.config?.templateFileUrl;return t||(t="assets/dev/default-templates.json"),this.http.get(t,{responseType:"json"}).pipe((0,d.map)(n=>(this.templates=new Array,n.forEach(r=>{this.templates.push(new je(r))}),this.templates)),(0,d.catchError)(n=>{throw console.log("Error reading Dev templates file",n),n}))}}filterTemplates(t){return t=t.toLowerCase(),this.getTemplates().pipe((0,d.map)(n=>n.filter(r=>!!r.name.toLowerCase().startsWith(t))))}}F.\u0275fac=function(t){return new(t||F)(e.\u0275\u0275inject(R.HttpClient),e.\u0275\u0275inject(v,8))},F.\u0275prov=e.\u0275\u0275defineInjectable({token:F,factory:F.\u0275fac,providedIn:"root"});class je{constructor(t){if(this.name=t.name,this.sequence=[],void 0!==t.position)this.sequence.push(new se(t.position,t.type,t.value));else for(const n of t.sequence)this.sequence.push(new se(n.position,n.type,n.value))}isSequence(){return!!this.sequence&&this.sequence.length>1}}class se{constructor(t,n,o){this.position=t,this.type=n,this.value=o}isValid(){return null!=this.position&&null!=this.type}}class ${constructor(t,n,o){this.pushService=t,this.templates=n,this.fb=o,this.position="creation/name",this.value="New Test",this.subscriptions=new c.Subscription,this.listTemplates=[],this.filteredTemplates=[],this.templateForm=this.fb.group({template:null,step:null,type:null,value:null}),this.filteredSteps=[],this.selectedStep=null,this.valueFieldLabel="Value",this.changeTypes=[{label:s.ChangeType.ADD},{label:s.ChangeType.UPDATE},{label:s.ChangeType.DELETE},{label:s.ChangeType.MOVE},{label:s.ChangeType.RESET}],this.openAddCommand=!0}ngOnInit(){this.subscriptions.add(this.templates.getTemplates().pipe((0,d.map)(t=>{this.listTemplates=t})).subscribe()),this.subscriptions.add(this.templateForm.get("template")?.valueChanges.pipe((0,d.map)(t=>{const n=this.templateForm.get("step"),o=this.templateForm.get("type");if(null==n||null==o)throw new Error("Cannot find value and type field");null!=t?(this.filteredSteps=t.sequence,n.setValue(t.sequence[0]),n.enable({emitEvent:!1}),o.setValue(t.sequence[0].type)):(n.setValue(null),n.disable({emitEvent:!1}),o.setValue(null))})).subscribe()),this.subscriptions.add(this.templateForm.get("step")?.valueChanges.pipe((0,d.map)(t=>{const n=this.templateForm.get("value"),o=this.templateForm.get("type");if(null==n||null==o)throw new Error("Cannot find value and type field");null===t?(n.disable({emitEvent:!1}),o.disable({emitEvent:!1})):(n.enable({emitEvent:!1}),o.enable({emitEvent:!1})),"string"==typeof t?(this.templateForm.get("template")?.setValue(null,{emitEvent:!1}),null!=this.selectedStep&&(this.selectedStep.position=t)):(this.selectedStep=t,null!=t&&(o.setValue(t.type),n.setValue("string"==typeof t.value?t.value:JSON.stringify(t.value,null,2))))})).subscribe()),this.subscriptions.add(this.templateForm.get("value")?.valueChanges.pipe((0,d.map)(t=>{const n=this.getSelectedStep();if(null!=n)if(null==t)n.value=t;else try{n.value=JSON.parse(t)}catch{n.value=t}})).subscribe()),this.subscriptions.add(this.templateForm.get("type")?.valueChanges.pipe((0,d.map)(t=>{const n=this.getSelectedStep();null!=n&&(n.type=t??""),this.valueFieldLabel=t===s.ChangeType.MOVE?"Before":"Value"})).subscribe())}ngOnDestroy(){this.subscriptions.unsubscribe()}sendCommand(){var t=this;return(0,X.Z)(function*(){const n=t.getSelectedTemplate();if(null!=n)for(const o of n.sequence)o.isValid()&&(yield t.pushChange(o.type,o.position,o.value));else{const o=t.getSelectedStep();null!=o&&o.isValid()&&(yield t.pushChange(o.type,o.position,o.value))}})()}searchTemplate(t){this.subscriptions.add(this.templates.filterTemplates(t.query).pipe((0,d.map)(n=>{this.filteredTemplates=n})).subscribe())}getSelectedTemplate(){return this.templateForm.get("template")?.value??null}getSelectedStep(){return this.selectedStep}searchStep(t){const n=t.query.toLowerCase(),o=this.getSelectedTemplate()?.sequence;this.filteredSteps=o?o.filter(r=>!!r.position.toLowerCase().startsWith(n)):[]}pushChange(t,n,o){"/"===n&&(n="");const r=new s.Change(s.ChangeType[t],n,o);return t===s.ChangeType.MOVE&&(r.value=null,r.oldPosition=n,r.beforeKey=o),this.pushService.pushChange(r)}}$.\u0275fac=function(t){return new(t||$)(e.\u0275\u0275directiveInject(O),e.\u0275\u0275directiveInject(F),e.\u0275\u0275directiveInject(h.FormBuilder))},$.\u0275cmp=e.\u0275\u0275defineComponent({type:$,selectors:[["dontcode-sandbox-insert-command"]],decls:26,vars:9,consts:[["header","Add Command",3,"selected"],[1,"p-fluid","formgrid","grid",3,"formGroup"],[1,"field","col-12","md:col-9"],[1,"p-float-label"],["id","template","formControlName","template","field","name",3,"suggestions","dropdown","completeMethod"],["for","template"],[1,"field","col-12","md:col-3"],["id","sendButton","label","Send",3,"click"],["id","step","formControlName","step","field","position",3,"suggestions","dropdown","completeMethod"],["for","step"],["id","type","formControlName","type","field","type","optionValue","label",3,"options"],["for","type"],[1,"field","col-12"],["pInputTextarea","","id","value","formControlName","value","field","value","rows","10",3,"autoResize"],["for","value"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"p-accordion")(1,"p-accordionTab",0)(2,"div",1)(3,"div",2)(4,"span",3)(5,"p-autoComplete",4),e.\u0275\u0275listener("completeMethod",function(r){return n.searchTemplate(r)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"label",5),e.\u0275\u0275text(7,"Select a Template"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(8,"div",6)(9,"p-button",7),e.\u0275\u0275listener("click",function(){return n.sendCommand()}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(10,"div",2)(11,"span",3)(12,"p-autoComplete",8),e.\u0275\u0275listener("completeMethod",function(r){return n.searchStep(r)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"label",9),e.\u0275\u0275text(14,"Step"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(15,"div",6)(16,"span",3),e.\u0275\u0275element(17,"p-dropdown",10),e.\u0275\u0275elementStart(18,"label",11),e.\u0275\u0275text(19,"Select a type"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(20,"div",12)(21,"span",3)(22,"textarea",13),e.\u0275\u0275text(23,"          "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(24,"label",14),e.\u0275\u0275text(25),e.\u0275\u0275elementEnd()()()()()()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("selected",n.openAddCommand),e.\u0275\u0275advance(1),e.\u0275\u0275property("formGroup",n.templateForm),e.\u0275\u0275advance(3),e.\u0275\u0275property("suggestions",n.filteredTemplates)("dropdown",!0),e.\u0275\u0275advance(7),e.\u0275\u0275property("suggestions",n.filteredSteps)("dropdown",!0),e.\u0275\u0275advance(5),e.\u0275\u0275property("options",n.changeTypes),e.\u0275\u0275advance(5),e.\u0275\u0275property("autoResize",!0),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(n.valueFieldLabel))},dependencies:[Q.Accordion,Q.AccordionTab,oe.AutoComplete,h.DefaultValueAccessor,h.NgControlStatus,h.NgControlStatusGroup,h.FormGroupDirective,h.FormControlName,ie.InputTextarea,k.Button,re.Dropdown]});class L{}L.\u0275fac=function(t){return new(t||L)},L.\u0275cmp=e.\u0275\u0275defineComponent({type:L,selectors:[["dontcode-sandbox-debug-page"]],decls:12,vars:0,consts:[[1,"grid","flex-column"],[1,"col"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"h1"),e.\u0275\u0275text(3,"Debug Page"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"br"),e.\u0275\u0275text(5,"This page allows us to test your plugin by injecting the same commands than the Builder application. "),e.\u0275\u0275element(6,"br"),e.\u0275\u0275text(7,"You then can see the behavior of your Preview Plugin without running the Builder "),e.\u0275\u0275element(8,"br"),e.\u0275\u0275text(9," Please select the command to add: "),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(10,"dontcode-sandbox-insert-command",1)(11,"dontcode-sandbox-list-commands",1),e.\u0275\u0275elementEnd())},dependencies:[W,$]});class J{constructor(t,n,o,r){this.route=t,this.provider=n,this.loader=o,this.injector=r,this.subscriptions=new c.Subscription,this.screenName$=c.EMPTY}ngOnInit(){this.screenName$=this.route.params}ngOnDestroy(){this.subscriptions.unsubscribe()}ngAfterViewInit(){this.subscriptions.add(this.route.url.pipe((0,d.map)(t=>{let n=null;if(t.forEach(r=>{n=null===n?r.path:n+"/"+r.path}),console.log("Searching for component handling route",n),null==n)throw new Error("No position in route to screen");if(null==this.provider)throw new Error("No provider");try{const r=this.provider.calculatePointerFor(n);this.dynamicInsertPoint.clear(),this.loader.insertComponent(r,this.dynamicInsertPoint,this.provider.getJsonAt(n)).then(a=>{null==a&&this.loader.createComponent(D,this.dynamicInsertPoint,void 0,r)})}catch(r){console.warn("Error creating component for "+n+":",r),this.loader.createComponent(D,this.dynamicInsertPoint,void 0,new s.DontCodeModelPointer(n,n))}})).subscribe())}providesTemplates(t){throw new Error("Method not implemented.")}canProvide(t){throw new Error("Method not implemented.")}}J.\u0275fac=function(t){return new(t||J)(e.\u0275\u0275directiveInject(B.ActivatedRoute),e.\u0275\u0275directiveInject(f),e.\u0275\u0275directiveInject(u.ComponentLoaderService),e.\u0275\u0275directiveInject(e.Injector))},J.\u0275cmp=e.\u0275\u0275defineComponent({type:J,selectors:[["dontcode-sandbox-screen"]],viewQuery:function(t,n){if(1&t&&e.\u0275\u0275viewQuery(u.DynamicInsertPoint,5,e.ViewContainerRef),2&t){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.dynamicInsertPoint=o.first)}},decls:1,vars:0,template:function(t,n){1&t&&e.\u0275\u0275element(0,"dtcde-dynamic")},dependencies:[u.DynamicInsertPoint]});const Te=[{path:"",component:z},{path:"dev",component:L},{path:"newTabDev",component:L},{path:"creation/:type/:id",component:J}];class E{static forRoot(t){return{ngModule:E,providers:[{provide:v,useValue:t},{provide:u.DONT_CODE_STORE_API_URL,useValue:t.storeUrl},{provide:u.DONT_CODE_DOC_API_URL,useValue:t.documentUrl}]}}}E.\u0275fac=function(t){return new(t||E)},E.\u0275mod=e.\u0275\u0275defineNgModule({type:E}),E.\u0275inj=e.\u0275\u0275defineInjector({providers:[{provide:u.COMMAND_PROVIDER,useExisting:f}],imports:[M,_,A,B.RouterModule.forChild(Te),M,_]})},5861:(ae,Y,l)=>{function p(c,s,V,I,v,N,P){try{var y=c[N](P),S=y.value}catch(R){return void V(R)}y.done?s(S):Promise.resolve(S).then(I,v)}function e(c){return function(){var s=this,V=arguments;return new Promise(function(I,v){var N=c.apply(s,V);function P(S){p(N,I,v,P,y,"next",S)}function y(S){p(N,I,v,P,y,"throw",S)}P(void 0)})}}l.d(Y,{Z:()=>e})}}]);