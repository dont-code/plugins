(self.webpackChunkplugin_tester=self.webpackChunkplugin_tester||[]).push([[5876],{5876:(at,E,I)=>{I.r(E),I.d(E,{BroadcastChannel:()=>P,OPEN_BROADCAST_CHANNELS:()=>k,beLeader:()=>G,clearNodeFolder:()=>ze,createLeaderElection:()=>st,enforceOptions:()=>Ge});var X=Promise.resolve(!1),q=Promise.resolve(!0),l=Promise.resolve();function p(e,t){return e||(e=0),new Promise(function(n){return setTimeout(function(){return n(t)},e)})}function w(){return Math.random().toString(36).substring(2)}var T=0,C=0;function b(){var e=(new Date).getTime();return e===T?1e3*e+ ++C:(T=e,C=0,1e3*e)}var se={create:function ee(e){var t={messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(n){t.messagesCallback&&t.messagesCallback(n.data)},t},close:function te(e){e.bc.close(),e.subFns=[]},onMessage:function re(e,t){e.messagesCallback=t},postMessage:function ne(e,t){try{return e.bc.postMessage(t,!1),l}catch(n){return Promise.reject(n)}},canBeUsed:function ie(){if(typeof window>"u")return!1;if("function"==typeof BroadcastChannel){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}return!1},type:"native",averageResponseTime:function oe(){return 150},microSeconds:b},B=function(){function e(t){this.ttl=t,this.map=new Map,this._to=!1}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.add=function(t){var n=this;this.map.set(t,D()),this._to||(this._to=!0,setTimeout(function(){n._to=!1,function ae(e){for(var t=D()-e.ttl,n=e.map[Symbol.iterator]();;){var r=n.next().value;if(!r)return;if(!(r[1]<t))return;e.map.delete(r[0])}}(n)},0))},e.prototype.clear=function(){this.map.clear()},e}();function D(){return(new Date).getTime()}function L(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=JSON.parse(JSON.stringify(e));return typeof t.webWorkerSupport>"u"&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=45e3),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&"function"==typeof e.idb.onclose&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=6e4),e.methods&&(t.methods=e.methods),t.node||(t.node={}),t.node.ttl||(t.node.ttl=12e4),t.node.maxParallelWrites||(t.node.maxParallelWrites=2048),typeof t.node.useFastPath>"u"&&(t.node.useFastPath=!0),t}var c="messages",_={durability:"relaxed"};function O(){if(typeof indexedDB<"u")return indexedDB;if(typeof window<"u"){if(typeof window.mozIndexedDB<"u")return window.mozIndexedDB;if(typeof window.webkitIndexedDB<"u")return window.webkitIndexedDB;if(typeof window.msIndexedDB<"u")return window.msIndexedDB}return!1}function y(e){e.commit&&e.commit()}function x(e){e.closed||R(e).then(function(){return p(e.options.idb.fallbackInterval)}).then(function(){return x(e)})}function R(e){return e.closed||!e.messagesCallback?l:function he(e,t){var n=e.transaction(c,"readonly",_),r=n.objectStore(c),i=[],o=IDBKeyRange.bound(t+1,1/0);if(r.getAll){var s=r.getAll(o);return new Promise(function(u,f){s.onerror=function(h){return f(h)},s.onsuccess=function(h){u(h.target.result)}})}return new Promise(function(u,f){var h=function a(){try{return o=IDBKeyRange.bound(t+1,1/0),r.openCursor(o)}catch{return r.openCursor()}}();h.onerror=function(d){return f(d)},h.onsuccess=function(d){var g=d.target.result;g?g.value.id<t+1?g.continue(t+1):(i.push(g.value),g.continue()):(y(n),u(i))}})}(e.db,e.lastCursorId).then(function(t){var n=t.filter(function(r){return!!r}).map(function(r){return r.id>e.lastCursorId&&(e.lastCursorId=r.id),r}).filter(function(r){return function ge(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}(r,e)}).sort(function(r,i){return r.time-i.time});return n.forEach(function(r){e.messagesCallback&&(e.eMIs.add(r.id),e.messagesCallback(r.data))}),l})}var Me={create:function _e(e,t){return t=L(t),function de(e){var r=O().open("pubkey.broadcast-channel-0-"+e);return r.onupgradeneeded=function(i){i.target.result.createObjectStore(c,{keyPath:"id",autoIncrement:!0})},new Promise(function(i,o){r.onerror=function(s){return o(s)},r.onsuccess=function(){i(r.result)}})}(e).then(function(n){var r={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:w(),eMIs:new B(2*t.idb.ttl),writeBlockPromise:l,messagesCallback:null,readQueuePromises:[],db:n};return n.onclose=function(){r.closed=!0,t.idb.onclose&&t.idb.onclose()},x(r),r})},close:function we(e){e.closed=!0,e.db.close()},onMessage:function Le(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t,R(e)},postMessage:function be(e,t){return e.writeBlockPromise=e.writeBlockPromise.then(function(){return function le(e,t,n){var i={uuid:t,time:(new Date).getTime(),data:n},o=e.transaction([c],"readwrite",_);return new Promise(function(s,a){o.oncomplete=function(){return s()},o.onerror=function(f){return a(f)},o.objectStore(c).add(i),y(o)})}(e.db,e.uuid,t)}).then(function(){0===function Y(e,t){return Math.floor(Math.random()*(t-e+1)+e)}(0,10)&&function me(e){return function ve(e,t){var n=(new Date).getTime()-t,r=e.transaction(c,"readonly",_),i=r.objectStore(c),o=[];return new Promise(function(s){i.openCursor().onsuccess=function(a){var u=a.target.result;if(u){var f=u.value;f.time<n?(o.push(f),u.continue()):(y(r),s(o))}else s(o)}})}(e.db,e.options.idb.ttl).then(function(t){return function pe(e,t){if(e.closed)return Promise.resolve([]);var r=e.db.transaction(c,"readwrite",_).objectStore(c);return Promise.all(t.map(function(i){var o=r.delete(i);return new Promise(function(s){o.onsuccess=function(){return s()}})}))}(e,t.map(function(n){return n.id}))})}(e)}),e.writeBlockPromise},canBeUsed:function ye(){return!!O()},type:"idb",averageResponseTime:function Ce(e){return 2*e.idb.fallbackInterval},microSeconds:b};function N(){var e;if(typeof window>"u")return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch{}return e}function A(e){return"pubkey.broadcastChannel-"+e}function F(){var e=N();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch{return!1}return!0}var Re={create:function Be(e,t){if(t=L(t),!F())throw new Error("BroadcastChannel: localstorage cannot be used");var n=w(),r=new B(t.localstorage.removeTimeout),i={channelName:e,uuid:n,eMIs:r};return i.listener=function Ie(e,t){var n=A(e),r=function(o){o.key===n&&t(JSON.parse(o.newValue))};return window.addEventListener("storage",r),r}(e,function(o){i.messagesCallback&&o.uuid!==n&&(!o.token||r.has(o.token)||o.data.time&&o.data.time<i.messagesCallbackTime||(r.add(o.token),i.messagesCallback(o.data)))}),i},close:function De(e){!function Te(e){window.removeEventListener("storage",e)}(e.listener)},onMessage:function Oe(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t},postMessage:function Ee(e,t){return new Promise(function(n){p().then(function(){var r=A(e.channelName),i={token:w(),time:(new Date).getTime(),data:t,uuid:e.uuid},o=JSON.stringify(i);N().setItem(r,o);var s=document.createEvent("Event");s.initEvent("storage",!0,!0),s.key=r,s.newValue=o,window.dispatchEvent(s),n()})})},canBeUsed:F,type:"localstorage",averageResponseTime:function xe(){var t=navigator.userAgent.toLowerCase();return t.includes("safari")&&!t.includes("chrome")?240:120},microSeconds:b},Ne=b,M=new Set,Ve={create:function Fe(e){var t={name:e,messagesCallback:null};return M.add(t),t},close:function Qe(e){M.delete(e)},onMessage:function Je(e,t){e.messagesCallback=t},postMessage:function Ue(e,t){return new Promise(function(n){return setTimeout(function(){Array.from(M).filter(function(i){return i.name===e.name}).filter(function(i){return i!==e}).filter(function(i){return!!i.messagesCallback}).forEach(function(i){return i.messagesCallback(t)}),n()},5)})},canBeUsed:function je(){return!0},type:"simulate",averageResponseTime:function We(){return 5},microSeconds:Ne},Q=[se,Me,Re];function U(e){var t=[].concat(e.methods,Q).filter(Boolean);if(e.type){if("simulate"===e.type)return Ve;var n=t.find(function(i){return i.type===e.type});if(n)return n;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||(t=t.filter(function(i){return"idb"!==i.type}));var r=t.find(function(i){return i.canBeUsed()});if(r)return r;throw new Error("No usable method found in "+JSON.stringify(Q.map(function(i){return i.type})))}var S,k=new Set,He=0,P=function(t,n){this.id=He++,k.add(this),this.name=t,S&&(n=S),this.options=L(n),this.method=U(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,function Ke(e){var t=e.method.create(e.name,e.options);!function K(e){return e&&"function"==typeof e.then}(t)?e._state=t:(e._prepP=t,t.then(function(n){e._state=n}))}(this)};function ze(e){var t=U(e=L(e));return"node"===t.type?t.clearNodeFolder().then(function(){return!0}):X}function Ge(e){S=e}function J(e,t,n){var i={time:e.method.microSeconds(),type:t,data:n};return(e._prepP?e._prepP:l).then(function(){var s=e.method.postMessage(e._state,i);return e._uMP.add(s),s.catch().then(function(){return e._uMP.delete(s)}),s})}function j(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function W(e,t,n){e._addEL[t].push(n),function Xe(e){if(!e._iL&&j(e)){var t=function(i){e._addEL[i.type].forEach(function(o){i.time>=o.time-1e5&&o.fn(i.data)})},n=e.method.microSeconds();e._prepP?e._prepP.then(function(){e._iL=!0,e.method.onMessage(e._state,t,n)}):(e._iL=!0,e.method.onMessage(e._state,t,n))}}(e)}function V(e,t,n){e._addEL[t]=e._addEL[t].filter(function(r){return r!==n}),function qe(e){if(e._iL&&!j(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}(e)}P._pubkey=!0,P.prototype={postMessage:function(t){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(t));return J(this,"message",t)},postInternal:function(t){return J(this,"internal",t)},set onmessage(e){var n={time:this.method.microSeconds(),fn:e};V(this,"message",this._onML),e&&"function"==typeof e?(this._onML=n,W(this,"message",n)):this._onML=null},addEventListener:function(t,n){W(this,t,{time:this.method.microSeconds(),fn:n})},removeEventListener:function(t,n){V(this,t,this._addEL[t].find(function(i){return i.fn===n}))},close:function(){var t=this;if(!this.closed){k.delete(this),this.closed=!0;var n=this._prepP?this._prepP:l;return this._onML=null,this._addEL.message=[],n.then(function(){return Promise.all(Array.from(t._uMP))}).then(function(){return Promise.all(t._befC.map(function(r){return r()}))}).then(function(){return t.method.close(t._state)})}},get type(){return this.method.type},get isClosed(){return this.closed}};var et="[object process]"===Object.prototype.toString.call(typeof process<"u"?process:0)?function Ze(e){process.on("exit",function(){return e()}),process.on("beforeExit",function(){return e().then(function(){return process.exit()})}),process.on("SIGINT",function(){return e().then(function(){return process.exit()})}),process.on("uncaughtException",function(t){return e().then(function(){console.trace(t),process.exit(101)})})}:function Ye(e){if("function"==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){var t=self.close.bind(self);self.close=function(){return e(),t()}}else{if("function"!=typeof window.addEventListener)return;window.addEventListener("beforeunload",function(){e()},!0),window.addEventListener("unload",function(){e()},!0)}},v=new Set,H=!1;function rt(){var e=[];return v.forEach(function(t){e.push(t()),v.delete(t)}),Promise.all(e)}var z=function(t,n){var r=this;this.broadcastChannel=t,this._options=n,this.isLeader=!1,this.hasLeader=!1,this.isDead=!1,this.token=w(),this._aplQ=l,this._aplQC=0,this._unl=[],this._lstns=[],this._dpL=function(){},this._dpLC=!1;var i=function(s){"leader"===s.context&&("death"===s.action&&(r.hasLeader=!1),"tell"===s.action&&(r.hasLeader=!0))};this.broadcastChannel.addEventListener("internal",i),this._lstns.push(i)};function m(e,t){return e.broadcastChannel.postInternal({context:"leader",action:t,token:e.token})}function G(e){e.isLeader=!0,e.hasLeader=!0;var t=function nt(e){if(function tt(){H||(H=!0,et(rt))}(),"function"!=typeof e)throw new Error("Listener is no function");return v.add(e),{remove:function(){return v.delete(e)},run:function(){return v.delete(e),e()}}}(function(){return e.die()});e._unl.push(t);var n=function(i){"leader"===i.context&&"apply"===i.action&&m(e,"tell"),"leader"===i.context&&"tell"===i.action&&!e._dpLC&&(e._dpLC=!0,e._dpL(),m(e,"tell"))};return e.broadcastChannel.addEventListener("internal",n),e._lstns.push(n),m(e,"tell")}function st(e,t){if(e._leaderElector)throw new Error("BroadcastChannel already has a leader-elector");t=function ot(e,t){return e||(e={}),(e=JSON.parse(JSON.stringify(e))).fallbackInterval||(e.fallbackInterval=3e3),e.responseTime||(e.responseTime=t.method.averageResponseTime(t.options)),e}(t,e);var n=new z(e,t);return e._befC.push(function(){return n.die()}),e._leaderElector=n,n}z.prototype={applyOnce:function(t){var n=this;return this.isLeader?p(0,!0):this.isDead?p(0,!1):this._aplQC>1?this._aplQ:(this._aplQC=this._aplQC+1,this._aplQ=this._aplQ.then(function(){return function(){if(n.isLeader)return q;var s,o=!1,a=new Promise(function(h){s=function(){o=!0,h()}}),u=function(d){"leader"===d.context&&d.token!=n.token&&("apply"===d.action&&d.token>n.token&&s(),"tell"===d.action&&(s(),n.hasLeader=!0))};n.broadcastChannel.addEventListener("internal",u);var f=t?4*n._options.responseTime:n._options.responseTime;return m(n,"apply").then(function(){return Promise.race([p(f),a.then(function(){return Promise.reject(new Error)})])}).then(function(){return m(n,"apply")}).then(function(){return Promise.race([p(f),a.then(function(){return Promise.reject(new Error)})])}).catch(function(){}).then(function(){return n.broadcastChannel.removeEventListener("internal",u),!o&&G(n).then(function(){return!0})})}()}).then(function(){n._aplQC=n._aplQC-1}),this._aplQ.then(function(){return n.isLeader}))},awaitLeadership:function(){return this._aLP||(this._aLP=function it(e){return e.isLeader?l:new Promise(function(t){var n=!1;function r(){n||(n=!0,e.broadcastChannel.removeEventListener("internal",o),t(!0))}e.applyOnce().then(function(){e.isLeader&&r()}),function s(){return p(e._options.fallbackInterval).then(function(){if(!e.isDead&&!n){if(!e.isLeader)return e.applyOnce(!0).then(function(){e.isLeader?r():s()});r()}})}();var o=function(a){"leader"===a.context&&"death"===a.action&&(e.hasLeader=!1,e.applyOnce().then(function(){e.isLeader&&r()}))};e.broadcastChannel.addEventListener("internal",o),e._lstns.push(o)})}(this)),this._aLP},set onduplicate(e){this._dpL=e},die:function(){var t=this;return this._lstns.forEach(function(n){return t.broadcastChannel.removeEventListener("internal",n)}),this._lstns=[],this._unl.forEach(function(n){return n.remove()}),this._unl=[],this.isLeader&&(this.hasLeader=!1,this.isLeader=!1),this.isDead=!0,m(this,"death")}}}}]);