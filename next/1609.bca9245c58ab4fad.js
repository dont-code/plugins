(self.webpackChunkplugin_tester=self.webpackChunkplugin_tester||[]).push([[1609,5861],{1609:(Z,O,m)=>{m.r(O),m.d(O,{AbstractDynamicComponent:()=>v,AbstractDynamicLoaderComponent:()=>H,AbstractPluginHandler:()=>$,AbstractReferenceComponent:()=>se,BaseDynamicEvent:()=>W,BaseDynamicEventSource:()=>J,BeautifierPipe:()=>U,COMMAND_PROVIDER:()=>T,CommonTestManager:()=>ue,ComponentLoaderService:()=>y,DONT_CODE_CORE:()=>_,DONT_CODE_DOC_API_URL:()=>S,DONT_CODE_STORE_API_URL:()=>V,DynamicEventType:()=>M,DynamicInsertPoint:()=>j,EntityListManager:()=>K,EntityStoreService:()=>le,PluginBaseComponent:()=>G,PluginCommonModule:()=>z,PluginCommonTestModule:()=>A,PluginHandlerHelper:()=>R,PossibleTemplateList:()=>Q,SubFieldInfo:()=>x,TemplateList:()=>k,ValueService:()=>ae});var c=m(6453),s=m(30549);let T=new s.InjectionToken("Inject the current command provider interface");const _=new s.InjectionToken("Dont-code core object"),V=new s.InjectionToken("DontCodeStoreApiUrl"),S=new s.InjectionToken("DontCodeStoreDocUrl");var h=m(27022),d=m(92256);let v=(()=>{var o;class n{constructor(){this.parentPosition=null,this.subscriptions=new d.Subscription}setName(e){this.name=e}getValue(){return null!=this.form&&this.updateValueFromForm(),this.value}setValue(e){this.value=e,null!=this.form&&this.hydrateValueToForm()}setParentPosition(e){this.parentPosition=e}setForm(e){this.form=e,null!=this.form&&null!=this.name&&this.createAndRegisterFormControls()}getForm(){return this.form}createAndRegisterFormControls(){const e=new h.FormControl(null,{updateOn:"blur"});this.form.registerControl(this.name,e)}transformToFormGroupValue(e){return e}transformFromFormGroupValue(e){return e}hydrateValueToForm(){if(null!=this.name){const e=this.form.get(this.name);if(null==e)throw new Error("No form control for the name "+this.name);{const t=this.transformToFormGroupValue(this.value);e.setValue(t,{emitEvent:!1})}}}updateValueFromForm(){if(null==this.name)return!1;const e=this.form.get(this.name);if(null==e)throw new Error("No form control for the name "+this.name);return!!e.dirty&&(this.value=this.transformFromFormGroupValue(e.value),e.markAsPristine({onlySelf:!0}),!0)}static toBeautifyString(e,t){if(null==e)return null;let r="";switch(Array.isArray(e)&&(e=e[0]),typeof e){case"string":r=e;break;case"object":r=e instanceof Date?e.toLocaleDateString():JSON.stringify(e,null,2);break;case"undefined":break;default:r=e.toLocaleString()}return null!=t&&r.length>t&&(r=r.substring(0,t-3)+"..."),r}listEventSources(){return[]}selectEventSourceFor(e,t){const r=this.listEventSources();for(const l of r)if(l.type===e){if(null==t)return l;if(l.name==t)return l}return null}ngOnDestroy(){this.subscriptions.unsubscribe()}}return(o=n).\u0275fac=function(e){return new(e||o)},o.\u0275cmp=s.\u0275\u0275defineComponent({type:o,selectors:[["ng-component"]],decls:0,vars:0,template:function(e,t){},encapsulation:2}),n})();var P=m(26891);let y=(()=>{var o;class n{constructor(e,t,r,l){this.injector=e,this.dontCodeCore=t,this.previewMgr=r,this.provider=l,this.moduleMap=new Map,this.mutex=new P.Mutex}getOrCreatePluginModuleRef(e){return this.mutex.acquire().then(t=>{try{let r=this.moduleMap.get(e);return r||(r=(0,s.createNgModule)((0,s.getNgModuleById)("dontcode-plugin/"+e),this.injector),r&&this.moduleMap.set(e,r)),r}finally{t()}})}loadPluginModule(e){return this.getOrCreatePluginModuleRef(e.class.source).then(t=>(null!=t&&this.dontCodeCore.initPlugins(),t))}insertComponentForFieldType(e,t){return this.insertComponent("creation/entities/fields/type",t,e)}insertComponent(e,t,r){let a,l=e.positionInSchema;l?(a=!0,r||(r=this.provider?.getJsonAt(e.position))):(a=!1,l=e);const u=this.previewMgr.retrieveHandlerConfig(l,r);return u?this.loadPluginModule(u).then(p=>{const I=p.instance.exposedPreviewHandlers().get(u.class.name);return this.createComponent(I,t,p,a?e:null)}).catch(p=>(console.error("Cannot load module because of ",p),Promise.reject("Cannot load module for source "+u.class.source+" because of "+p))):Promise.resolve(null)}createComponent(e,t,r,l){const p=t.createComponent(e,{injector:this.injector,ngModuleRef:r}).instance;if(p.initCommandFlow){if(!l)throw new Error("Component "+p.constructor.name+" is a PreviewHandler and parent position is missing.");if(!this.provider)throw new Error("Component "+p.constructor.name+" is a PreviewHandler and CommandProviderInterface is missing.");p.initCommandFlow(this.provider,l)}return p}registerModuleForTest(e,t){this.moduleMap.set(t,null==e.instance?(0,s.createNgModule)(e,this.injector):e)}}return(o=n).\u0275fac=function(e){return new(e||o)(s.\u0275\u0275inject(s.Injector),s.\u0275\u0275inject(_),s.\u0275\u0275inject(c.DontCodePreviewManager),s.\u0275\u0275inject(T,8))},o.\u0275prov=s.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"}),n})(),j=(()=>{var o;class n{}return(o=n).\u0275fac=function(e){return new(e||o)},o.\u0275dir=s.\u0275\u0275defineDirective({type:o,selectors:[["dtcde-dynamic"]]}),n})(),H=(()=>{var o;class n extends v{constructor(e,t,r){super(),this.loader=e,this.injector=t,this.ref=r,this.fields=new Array,this.fieldsMap=new Map,this.parentForm=null,this.componentInited=new d.ReplaySubject}defineSubField(e,t){const r=new x(e,t);this.addSubField(r)}getSubField(e){const t=this.fieldsMap.get(e);if(null!=t)return this.fields[t]}addSubField(e){const t=this.fields.push(e);return this.fieldsMap.set(e.name,t-1),t}getSubFields(){return this.fields}setForm(e){if(this.name){const t=new h.FormGroup({},{updateOn:"blur"});e.registerControl(this.name,t),super.setForm(t),this.parentForm=e}else super.setForm(e),this.parentForm=null;this.preloadSubFields()}hydrateValueToForm(){if(null==this.parentForm)super.hydrateValueToForm();else{let e=this.transformToFormGroupValue(this.value);for(const t in this.form.controls)null==this.fieldsMap.get(t)&&this.form.get(t)?.setValue(e&&e[t],{emitEvent:!1})}}updateValueFromForm(){if(null==this.parentForm)return super.updateValueFromForm();{let e=!1;for(const t in this.form.controls)if(null==this.fieldsMap.get(t)){const r=this.form.get(t);if(null!=r&&r.dirty){const l=this.transformFromFormGroupValue(r?.value);null==this.value&&(this.value={}),this.value[t]=l,e=!0,r.markAsPristine({onlySelf:!0})}}return e}}setValue(e){super.setValue(e);for(const t of this.fields)this.setSubFieldValue(t,null!=e?e[t.name]:void 0)}getValue(){let e=super.getValue();for(const t of this.fields){const r=this.getSubFieldValue(t);null!=r&&null==e&&(this.value={},e=this.value),e[t.name]!==r&&(e[t.name]=r)}return e}subFieldFullEditTemplate(e){const t="string"==typeof e?this.getSubField(e):e,r=t?.component;let l=null;if(null!=r&&(l=r.providesTemplates(t?.type).forFullEdit),null==e)throw new Error("No template for subField "+t?.name+" of component "+this.name);return l}subFieldInlineViewTemplate(e){const t="string"==typeof e?this.getSubField(e):e,r=t?.component;let l=null;if(null!=r&&(l=r.providesTemplates(t?.type).forInlineView),null==e)throw new Error("No template for subField "+t?.name+" of component "+this.name);return l}subFieldFullViewTemplate(e){const t="string"==typeof e?this.getSubField(e):e,r=t?.component;let l=null;if(null!=r&&(l=r.providesTemplates(t?.type).forFullView),null==e)throw new Error("No template for subField "+t?.name+" of component "+this.name);return l}loadSubField(e,t,r){const l="string"==typeof e?this.getSubField(e):e,a=l?.component;return null==a?this.loader.insertComponentForFieldType(t,this.dynamicInsertPoint).then(u=>null!=u?(this.prepareComponent(u,t,null!=l?l.name:null,r),u):null):Promise.resolve(a)}getSubFieldValue(e){const t="string"==typeof e?this.getSubField(e):e,r=t?.component;if(null!=r)return r.getValue();if(null!=this.form&&null!=t)return this.form.get(t.name)?.value;throw new Error("Cannot provide value for non existent subField "+e)}setSubFieldValue(e,t){const r="string"==typeof e?this.getSubField(e):e,l=r?.component;if(null!=l)l.setValue(t);else if(null!=this.form&&null!=r){const a={};let u=n.toBeautifyString(t);null==u&&(u=null),a[r.name]=u,this.form.patchValue(a,{emitEvent:!1})}}loadSubComponent(e,t,r,l){return new Promise((a,u)=>this.componentInited.subscribe({complete:()=>{a()},error:p=>{u(p)}})).then(()=>null==this.dynamicInsertPoint?null:this.loader.insertComponent(e,this.dynamicInsertPoint,l).then(a=>null!=a?this.prepareComponent(a,t,r,l):null))}prepareComponent(e,t,r,l){return r&&(null!=this.form&&(e.setName(r),e.setForm(this.form)),e.setValue(l)),e}applyComponentToSubField(e,t,r){let l=this.getSubField(r);return null==l?(l=new x(r,t,e),this.addSubField(l),!0):(l.component=e,!1)}ngAfterViewInit(){this.componentInited.complete(),this.preloadSubFields()}preloadSubFields(){if(null!=this.dynamicInsertPoint){let e=!1;for(const t of this.fields)null==t.component&&this.loadSubField(t.name,t.type,this.value?this.value[t.name]:void 0).then(l=>{null!=l&&this.applyComponentToSubField(l,t.type,t.name),null!=this.value&&!e&&(this.ref.detectChanges(),e=!0)})}}}return(o=n).\u0275fac=function(e){return new(e||o)(s.\u0275\u0275directiveInject(y),s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(s.ChangeDetectorRef))},o.\u0275cmp=s.\u0275\u0275defineComponent({type:o,selectors:[["ng-component"]],viewQuery:function(e,t){if(1&e&&s.\u0275\u0275viewQuery(j,5,s.ViewContainerRef),2&e){let r;s.\u0275\u0275queryRefresh(r=s.\u0275\u0275loadQuery())&&(t.dynamicInsertPoint=r.first)}},features:[s.\u0275\u0275InheritDefinitionFeature],decls:0,vars:0,template:function(e,t){},encapsulation:2}),n})();class x{constructor(n,i,e){this.name=n,this.type=i,this.component=e}}var L=m(15861),E=m(2369);class R{constructor(){this.subscriptions=new d.Subscription,this.entityPointer=null,this.provider=null,this.changeHandler=null,this.actionPerformer=null,this.mutex=new P.Mutex}initCommandFlow(n,i,e,t){this.entityPointer=i,this.provider=n,this.changeHandler=e,null!=t?this.actionPerformer=t:null!=e.performAction&&(this.actionPerformer=e)}decomposeJsonToMultipleChanges(n,i){if("object"==typeof i&&this.provider){let e;const t=this.provider.getSchemaManager();for(const r in i)if(i.hasOwnProperty(r)){const l=t.generateSubSchemaPointer(n,r),a=t.locateItem(l.positionInSchema);a?.isArray()&&l.isProperty?this.decomposeJsonToMultipleChanges(l,i[r]):(e=new c.Change(c.ChangeType.RESET,n.position+"/"+r,i[r],l),!a&&e.pointer&&(e.pointer.isProperty=!1),null!=this.changeHandler&&this.changeHandler.handleChange(e))}}}initChangeListening(n){this.initOtherChangeListening(n,this.entityPointer)}initOtherChangeListening(n,i){if(!this.provider||!i)throw new Error("Cannot listen to change before initCommandFlow is called");{let e=i.position;!0!==n&&(e+="/?"),this.subscriptions.add(this.provider.receiveCommands(e).pipe((0,E.map)(t=>{null!=t.actionType?this.actionPerformer&&t.running?.next(this.actionPerformer.performAction(t)):this.changeHandler&&this.changeHandler.handleChange(t)})).subscribe())}}applyUpdatesToArray(n,i,e,t,r,l){return this.applyUpdatesToArrayAsync(n,i,e,t,(a,u)=>Promise.resolve(r(a,u)))}applyUpdatesToArrayAsync(n,i,e,t,r,l,a){return this.mutex.runExclusive(()=>{try{if(!this.provider)throw new Error("Cannot apply updates before initCommandFlow is called");e.pointer||(e.pointer=this.provider.calculatePointerFor(e.position)),l=l??this.entityPointer?.position,null!=t&&(l=l+"/"+t);const u=e.pointer.containerPosition===l;let p=u?e.pointer.lastElement:c.DontCodeModelPointer.lastElementOf(e.pointer.containerPosition)??null,I=e.pointer.isProperty?e.pointer.lastElement:null,b=null,D=null,g=-1,C=-1;switch(null!=p&&i.has(p)&&(g=i.get(p),D=n[g],b=(0,d.of)(D)),e.beforeKey&&(C=i.get(e.beforeKey)),e.type){case c.ChangeType.ADD:case c.ChangeType.UPDATE:case c.ChangeType.RESET:if(null!=I){if(!D||D&&(!a||!a(D,I,e.value))){const f=this.provider.getJsonAt(e.pointer.containerPosition),w=this.provider.calculatePointerFor(e.pointer.containerPosition);if(w.isProperty)throw new Error("A parent of a property "+e.pointer.position+" must be an array");b=(0,d.from)(r(w,f))}}else b=(0,d.from)(r(e.pointer,e.value));break;case c.ChangeType.MOVE:-1!==g&&u&&p&&(-1!==C&&C>g&&C--,n.splice(g,1),i.forEach((f,w)=>{f>g&&i.set(w,f-1)}),i.delete(p),g=-1);break;case c.ChangeType.DELETE:-1!==g&&u&&p&&(n.splice(g,1),i.forEach((f,w)=>{f>g&&i.set(w,f-1)}),i.delete(p)),b=null}return b?(0,d.firstValueFrom)(b.pipe((0,E.map)(f=>{if(-1!==g)n[g]=f;else if(-1!==C){if(n.splice(C,0,f),i.forEach((w,pe)=>{w>=C&&i.set(pe,w+1)}),null==p)throw new Error("Cannot set targetPos "+C+" without knowing the itemId");i.set(p,C)}else{if(n.push(f),null==p)throw new Error("Cannot set targetPos "+C+" without knowing the itemId");i.set(p,i.size)}return n}),(0,E.takeLast)(1),(0,E.catchError)(f=>Promise.reject(f)))):Promise.resolve(n)}catch(u){return Promise.reject(u)}})}unsubscribe(){this.subscriptions.unsubscribe()}performAction(n){var i=this;return(0,L.Z)(function*(){if(null==i.provider)return Promise.reject("No provider for the component at position "+i.entityPointer?.position);yield i.provider.sendCommand(n)})()}}let G=(()=>{var o;class n extends H{constructor(e,t,r){super(e,t,r),this.pluginHelper=new R,this.entityPointer=null,this.provider=null}ngOnDestroy(){this.pluginHelper.unsubscribe(),super.ngOnDestroy()}updateValueOnFormChanges(){this.subscriptions.add(this.form.valueChanges.pipe((0,E.map)(e=>(this.getValue(),e))).subscribe())}initCommandFlow(e,t){this.entityPointer=t,this.provider=e,this.pluginHelper.initCommandFlow(e,t,this)}initChangeListening(e){this.pluginHelper.initChangeListening(e)}decomposeJsonToMultipleChanges(e,t){this.pluginHelper.decomposeJsonToMultipleChanges(e,t)}decodeStringField(e,t){if(e.pointer?.lastElement===t)return e.value}applyUpdatesToArray(e,t,r,l,a,u,p){return this.applyUpdatesToArrayAsync(e,t,r,l,(I,b)=>Promise.resolve(a(I,b)),u)}applyUpdatesToArrayAsync(e,t,r,l,a,u,p){return this.pluginHelper.applyUpdatesToArrayAsync(e,t,r,l,a,u,p)}updateSubFieldsWithChange(e,t,r){return this.applyUpdatesToArrayAsync(this.fields,this.fieldsMap,e,t,(l,a)=>this.loadSubComponent(l,a.type,a.name).then(u=>new x(a.name,a.type,u??void 0)),r,(l,a,u)=>a===c.DontCodeModel.APP_FIELDS_NAME_NODE&&(l.name=u,!0)).then(l=>(this.fields=l,this.rebuildForm(),l))}rebuildForm(){if(null==this.form)return;const e=new Set;for(const t in this.form.controls)e.add(t);for(const t of this.fields){let r=null;this.value&&this.value[t.name]&&(r=this.value[t.name]),e.delete(t.name),null!=t.component?t.component?.setValue(r):(r=n.toBeautifyString(r),this.form.registerControl(t.name,new h.FormControl(r,h.Validators.required)))}e.forEach(t=>{this.form.removeControl(t)})}}return(o=n).\u0275fac=function(e){return new(e||o)(s.\u0275\u0275directiveInject(y),s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(s.ChangeDetectorRef))},o.\u0275cmp=s.\u0275\u0275defineComponent({type:o,selectors:[["ng-component"]],features:[s.\u0275\u0275InheritDefinitionFeature],decls:0,vars:0,template:function(e,t){},encapsulation:2}),n})(),U=(()=>{var o;class n{transform(e,...t){return G.toBeautifyString(e,t[0])}}return(o=n).\u0275fac=function(e){return new(e||o)},o.\u0275pipe=s.\u0275\u0275definePipe({name:"beautifier",type:o,pure:!0}),n})();var B=m(46674),N=m(57863);class ${constructor(){this.subscriptions=new d.Subscription,this.pluginHelper=new R,this.entityPointer=null,this.provider=null}unsubscribe(){this.pluginHelper.unsubscribe(),this.subscriptions.unsubscribe()}initCommandFlow(n,i){this.entityPointer=i,this.provider=n,this.pluginHelper.initCommandFlow(n,i,this)}initChangeListening(){this.pluginHelper.initChangeListening()}decomposeJsonToMultipleChanges(n,i){this.pluginHelper.decomposeJsonToMultipleChanges(n,i)}applyUpdatesToArray(n,i,e,t,r,l){return this.applyUpdatesToArrayAsync(n,i,e,t,(a,u)=>Promise.resolve(r(a,u)))}applyUpdatesToArrayAsync(n,i,e,t,r,l,a){return this.pluginHelper.applyUpdatesToArrayAsync(n,i,e,t,r,l,a)}performAction(n){return Promise.resolve(void 0)}}class k{constructor(n,i,e){this.forInlineView=n,this.forFullView=i,this.forFullEdit=e}}class Q{constructor(n,i,e){this.forInlineView=n,this.forFullView=i,this.forFullEdit=e}}class J{constructor(n,i,e){this.name=n,this.type=i,this.eventSource=e}}var M=(()=>{return(o=M||(M={})).VALUE_CHANGE="VALUE_CHANGE",o.SELECTION_CHANGE="SELECTION_CHANGE",M;var o})();class W{constructor(n,i,e){this.name=n,this.type=i,this.value=e}}var q=m(3134);const X=["inlineView"],Y=["fullEditView"];function ee(o,n){if(1&o&&s.\u0275\u0275text(0),2&o){const i=s.\u0275\u0275nextContext();s.\u0275\u0275textInterpolate(i.value)}}function te(o,n){if(1&o&&(s.\u0275\u0275elementStart(0,"div"),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),2&o){const i=s.\u0275\u0275nextContext(4);s.\u0275\u0275advance(1),s.\u0275\u0275textInterpolate1(" ",i.value," ")}}function ne(o,n){if(1&o&&s.\u0275\u0275template(0,te,2,1,"div",7),2&o){const i=s.\u0275\u0275nextContext(3);s.\u0275\u0275property("ngIf",i.value)}}function re(o,n){1&o&&s.\u0275\u0275text(0),2&o&&s.\u0275\u0275textInterpolate1(" ",n.$implicit," ")}function ie(o,n){if(1&o){const i=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementContainerStart(0,3),s.\u0275\u0275elementStart(1,"p-dropdown",4),s.\u0275\u0275listener("onChange",function(t){s.\u0275\u0275restoreView(i);const r=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(r.valueChanged(t))}),s.\u0275\u0275template(2,ne,1,1,"ng-template",5),s.\u0275\u0275template(3,re,1,1,"ng-template",6),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementContainerEnd()}if(2&o){const i=s.\u0275\u0275nextContext(2);s.\u0275\u0275property("formGroup",i.form),s.\u0275\u0275advance(1),s.\u0275\u0275property("options",i.options)("formControlName",i.name)("filter",!0)("showClear",!0)("lazy",!0)}}function oe(o,n){if(1&o&&s.\u0275\u0275template(0,ie,4,6,"ng-container",2),2&o){const i=s.\u0275\u0275nextContext();s.\u0275\u0275property("ngIf",i.form)}}let se=(()=>{var o;class n extends v{constructor(e,t){super(),this.modelMgr=e,this.storeMgr=t,this.valueChange=new s.EventEmitter,this.targetEntitiesPos=null,this.targetEntitiesProperty=null,this.options=new Array,null==e&&(this.modelMgr=c.dtcde.getModelManager()),null==t&&(this.storeMgr=c.dtcde.getStoreManager())}canProvide(e){return new Q(!0,!1,!0)}providesTemplates(e){return new k(this.inlineView,null,this.fullEditView)}setTargetEntitiesWithName(e,t){const r=this.modelMgr.queryModelToSingle("$.creation.entities[?(@.name=='"+e+"')]");if(null==r)throw console.error("Cannot find an entity with name "+e+" in the model."),new Error("Cannot find an entity with name "+e+" in the model.");return this.targetEntitiesPos=r.pointer,null==this.targetEntitiesPos?Promise.resolve(!1):(this.targetEntitiesProperty=t??null,(0,d.firstValueFrom)(this.possibleValues()).then(l=>(this.options=l,!0)))}possibleValues(){if(null==this.targetEntitiesPos)throw new Error("Missing query of target entity for class "+this.constructor.name);const e=this.storeMgr.searchEntities(this.targetEntitiesPos);if(null!=this.targetEntitiesProperty){const t=this.targetEntitiesProperty;return e.pipe((0,E.map)(r=>r.map(l=>l[t])))}return e}listEventSources(){const e=super.listEventSources();return e.push(new J("Value",M.VALUE_CHANGE,this.valueChange.asObservable())),e}valueChanged(e){this.valueChange.emit(new W("Value",M.VALUE_CHANGE,e.value))}setValue(e){null!=e&&null!=this.options&&-1==this.options.findIndex(t=>t==e)&&null!=this.options[1]&&(e=this.options[1].toString()),super.setValue(e)}}return(o=n).\u0275fac=function(e){return new(e||o)(s.\u0275\u0275directiveInject(c.DontCodeModelManager,8),s.\u0275\u0275directiveInject(c.DontCodeStoreManager,8))},o.\u0275cmp=s.\u0275\u0275defineComponent({type:o,selectors:[["dontcode-reference"]],viewQuery:function(e,t){if(1&e&&(s.\u0275\u0275viewQuery(X,7),s.\u0275\u0275viewQuery(Y,7)),2&e){let r;s.\u0275\u0275queryRefresh(r=s.\u0275\u0275loadQuery())&&(t.inlineView=r.first),s.\u0275\u0275queryRefresh(r=s.\u0275\u0275loadQuery())&&(t.fullEditView=r.first)}},outputs:{valueChange:"valueChange"},features:[s.\u0275\u0275InheritDefinitionFeature],decls:4,vars:0,consts:[["inlineView",""],["fullEditView",""],[3,"formGroup",4,"ngIf"],[3,"formGroup"],["placeholder","Select a reference",3,"options","formControlName","filter","showClear","lazy","onChange"],["pTemplate","selectedItem"],["pTemplate","item"],[4,"ngIf"]],template:function(e,t){1&e&&(s.\u0275\u0275template(0,ee,1,1,"ng-template",null,0,s.\u0275\u0275templateRefExtractor),s.\u0275\u0275template(2,oe,1,1,"ng-template",null,1,s.\u0275\u0275templateRefExtractor))},dependencies:[N.NgIf,B.Dropdown,q.PrimeTemplate,h.NgControlStatus,h.NgControlStatusGroup,h.FormGroupDirective,h.FormControlName],changeDetection:0}),n})(),le=(()=>{var o;class n{constructor(e,t){this.storeMgr=e,this.modelMgr=t,this.listsByPosition=new Map}retrieveListManager(e,t){let r=this.listsByPosition.get(e.position);return null==r&&(r=new K(e,t,this.storeMgr,this.modelMgr),this.listsByPosition.set(e.position,r)),r}}return(o=n).\u0275fac=function(e){return new(e||o)(s.\u0275\u0275inject(c.DontCodeStoreManager),s.\u0275\u0275inject(c.DontCodeModelManager))},o.\u0275prov=s.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"}),n})();class K{constructor(n,i,e,t){this.storeMgr=e,this.modelMgr=t,this.entities=null,this.prepared=null,this.pointer=n,this.description=i}push(n){this.entities=null==this.entities?new Array(n):[...this.entities,n]}updateWithDetailedEntity(n){const i=n._id,e=new Array;return null!=this.entities?(this.entities.forEach(t=>{t._id==i?(n={...n,...t},e.push(n)):e.push(t)}),this.entities=[...e]):this.entities=[n],n}replace(n){if(null==this.entities)return!1;const i=n._id;let e=!1;const t=new Array;return this.entities.forEach(r=>{r._id==i?(t.push(n),e=!0):t.push(r)}),this.entities=[...t],e}remove(n){if(null==this.entities)return Promise.resolve(!1);const i=n._id;return null==i?new Promise(e=>{null!=this.entities?(this.entities=this.entities.filter(t=>t!==n),this.prepared=null,e(!0)):e(!1)}):this.storeMgr.deleteEntity(this.pointer.position,i).then(e=>(e&&null!=this.entities&&(this.entities=this.entities.filter(t=>t!==n),this.prepared=null),e)).catch(e=>(console.error(e.message),!1))}reset(){null!=this.entities&&(this.entities.length=0),this.prepared=null}store(n){return this.prepared=null,this.storeMgr.storeEntity(this.pointer.position,n)}storeAllChanged(){var n=this;return(0,L.Z)(function*(){if(null!=n.entities){n.prepared=null;for(const i of n.entities)yield n.storeMgr.storeEntity(n.pointer.position,i)}})()}loadAll(){return(0,d.firstValueFrom)(this.storeMgr.searchEntities(this.pointer.position).pipe((0,E.map)(n=>{this.prepared=null,this.entities=[...n]})),{defaultValue:void 0})}searchAndPrepareEntities(n,i,e,...t){let r=null!=n?Object.values(n):[];const l=r.length>0?r[0]:void 0;r=null!=i?Object.values(i):[];const a=r.length>0?new c.DontCodeStoreGroupby(r[0].of,r[0].display,r[0].show):void 0;if(null!=this.entities){this.prepared=null;let p,u=this.entities;return null!=t&&(u=c.StoreProviderHelper.applyFilters(u,...t)),null!=l&&(u=c.StoreProviderHelper.multiSortArray(u,l)),null!=a&&(p=c.StoreProviderHelper.calculateGroupedByValues(u,a,this.modelMgr,this.pointer)),(null!=t||null!=n||null!=i)&&(this.prepared=new c.DontCodeStorePreparedEntities(u,l,p)),Promise.resolve()}return(0,d.firstValueFrom)(this.storeMgr.searchAndPrepareEntities(this.pointer.position,l,a,e,...t).pipe((0,E.map)(u=>{this.prepared=u,this.entities=this.prepared.sortedData})))}loadDetailFromKey(n){return null==n?Promise.reject("Cannot load entity with null key"):this.storeMgr.loadEntity(this.pointer.position,n).then(i=>null!=i?this.updateWithDetailedEntity(i):i)}loadDetailOf(n){return this.loadDetailFromKey(n._id)}}let ae=(()=>{var o;class n{constructor(e){this.modelMgr=e}getContent(){return this.modelMgr.getContent()}resetContent(e){this.modelMgr.resetContent(e)}findAtPosition(e,t){return this.modelMgr.findAtPosition(e,t)}queryModelToArray(e,t){return this.modelMgr.queryModelToArray(e,t)}queryModelToSingle(e,t){return this.modelMgr.queryModelToSingle(e,t)}findAllPossibleTargetsOfProperty(e,t,r){return this.modelMgr.findAllPossibleTargetsOfProperty(e,t,r)}findTargetOfProperty(e,t,r){return this.modelMgr.findTargetOfProperty(e,t,r)}}return(o=n).\u0275fac=function(e){return new(e||o)(s.\u0275\u0275inject(c.DontCodeModelManager))},o.\u0275prov=s.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"}),n})(),z=(()=>{var o;class n{static forRoot(){return{ngModule:n,providers:[{provide:_,useValue:c.dtcde},{provide:c.DontCodeSchemaManager,useValue:c.dtcde.getSchemaManager()},{provide:c.DontCodeModelManager,useValue:c.dtcde.getModelManager()},{provide:c.DontCodePreviewManager,useValue:c.dtcde.getPreviewManager()},{provide:c.DontCodeStoreManager,useValue:c.dtcde.getStoreManager()},{provide:c.DontCodeChangeManager,useValue:c.dtcde.getChangeManager()},U]}}}return(o=n).\u0275fac=function(e){return new(e||o)},o.\u0275mod=s.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=s.\u0275\u0275defineInjector({imports:[N.CommonModule,B.DropdownModule,h.ReactiveFormsModule]}),n})();class ue{static registerComponentForType(n,i,e){c.dtcde.registerPlugin(new ce({forType:n,name:i})),A.previewHandlers.set(i,e)}}class ce{constructor(n){this.testComponents=null,this.CONFIG={plugin:{id:"CommonTestManagerPlugin",version:"1.0"},"schema-updates":[{id:"test-component",description:"Test Component added",changes:[{location:{parent:"#/$defs/field",id:"type"},update:{enum:[{Test:{enum:[]}}]},replace:!1}]}],"preview-handlers":[]},this.PREVIEW_HANDLER_CONFIG={location:{parent:c.DontCodeModel.APP_FIELDS,id:"type",values:[{Test:{enum:[]}}]},class:{source:"common-test-module",name:"name"}},this.testComponents=n}getConfiguration(){if(null!=this.testComponents){const n=structuredClone(this.CONFIG),i=structuredClone(this.PREVIEW_HANDLER_CONFIG);if(null!=n["schema-updates"]&&null!=n["preview-handlers"])return n["schema-updates"][0].id=this.testComponents.name,n["schema-updates"][0].changes[0].update.enum[0].Test.enum.push(this.testComponents.forType),i.class.name=this.testComponents.name,i.location.values[0].Test.enum.push(this.testComponents.forType),n["preview-handlers"].push(i),n}throw new Error("No testComponent to register")}pluginInit(n){}}var F;class A{exposedPreviewHandlers(){return A.previewHandlers}}(F=A).previewHandlers=new Map,F.\u0275fac=function(n){return new(n||F)},F.\u0275mod=s.\u0275\u0275defineNgModule({type:F,id:"dontcode-plugin/common-test-module"}),F.\u0275inj=s.\u0275\u0275defineInjector({imports:[N.CommonModule,z]}),s.\u0275\u0275registerNgModuleType(A,"dontcode-plugin/common-test-module")},15861:(Z,O,m)=>{function c(T,_,V,S,h,d,v){try{var P=T[d](v),y=P.value}catch(j){return void V(j)}P.done?_(y):Promise.resolve(y).then(S,h)}function s(T){return function(){var _=this,V=arguments;return new Promise(function(S,h){var d=T.apply(_,V);function v(y){c(d,S,h,v,P,"next",y)}function P(y){c(d,S,h,v,P,"throw",y)}v(void 0)})}}m.d(O,{Z:()=>s})}}]);