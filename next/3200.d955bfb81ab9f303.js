(self.webpackChunkplugin_tester=self.webpackChunkplugin_tester||[]).push([[3200,5861],{13200:(Y,E,l)=>{l.r(E),l.d(E,{BaseAppComponent:()=>fe,ChangeListenerService:()=>C,ChangeModule:()=>A,ChangeProviderService:()=>f,CommandModule:()=>y,DefaultViewerComponent:()=>w,DontCodeRuntimeConfig:()=>H,GlobalPluginLoader:()=>R,IdeProject:()=>D,IndexedDbStorageService:()=>F,LayoutModule:()=>j,MainComponent:()=>me,RemotePluginLoaderService:()=>V,SandboxModule:()=>xe,SharedModule:()=>x});var m=l(57863),e=l(30549),c=l(92256),r=l(26282),M=l(4048),S=l(97848),d=l(33272),b=l(16602);let C=(()=>{class o{constructor(t,n){this.http=t,this.configService=n,this.listOfChanges=[],this.previewServiceWebSocket=null,this.socketSubscription=null,this.changeEmitter=new c.Subject,this.connectionStatus=new c.ReplaySubject(1),this.config=null,this.sessionId=null,this.sessionIdSubject=new c.ReplaySubject(1);try{this.configService.getUpdates().subscribe(i=>{const s=i.webSocketUrl!=this.config?.webSocketUrl;this.config=i,null!=i.projectApiUrl&&i.projectApiUrl.length>0&&(this.projectUrl=i.projectApiUrl),s&&this.initializeSocket(i.webSocketUrl)}),this.channel=new S.BroadcastChannel(d.CHANNEL_CHANGE_NAME,{}),this.channel.onmessage=i=>{this.listOfChanges.push(i),this.changeEmitter.next(i)}}catch(i){console.error("Error initializing ChangeListnerService",i)}}initializeSocket(t){null!=this.previewServiceWebSocket&&null!=this.socketSubscription&&(this.socketSubscription.unsubscribe(),this.socketSubscription=null,this.previewServiceWebSocket.complete(),this.previewServiceWebSocket=null,this.connectionStatus.next("closed")),null!=t&&t.length>0?(this.previewServiceWebSocket=(0,M.webSocket)(t),this.connectionStatus.next("connected"),this.socketSubscription=this.previewServiceWebSocket?.subscribe({next:n=>{n.type===r.MessageType.CHANGE&&(n.change?(this.listOfChanges.push(n.change),this.changeEmitter.next(n.change)):console.error("Received change message without a change..."))},error:n=>{this.connectionStatus.next("ERROR:"+n),this.sessionIdSubject.next(void 0)},complete:()=>{this.connectionStatus.next("closed"),this.sessionIdSubject.next(void 0)}})):(console.warn("No SANDBOX_CONFIG WebSocketUrl injected => Not listening to changes from servers"),this.connectionStatus.next("undefined"),this.sessionIdSubject.next(void 0))}getListOfChanges(){return this.listOfChanges}getChangeEvents(){return this.changeEmitter}getConnectionStatus(){return this.connectionStatus}setSessionId(t){this.sessionId=t,this.sessionIdSubject.next(t||void 0),this.previewServiceWebSocket&&this.previewServiceWebSocket.next(new r.Message(r.MessageType.INIT,t||void 0))}loadProject(t){if(this.sessionId)throw new Error("Cannot load a project while in a session with Builder. Please load the project ");return this.projectUrl?(0,c.firstValueFrom)(this.http.get(this.projectUrl+"/"+encodeURIComponent(t),{responseType:"json"}).pipe((0,c.map)(n=>{const i=new r.Change(r.ChangeType.RESET,"",n.content);return this.listOfChanges.push(i),this.changeEmitter.next(i),n}))):Promise.reject(new Error("Cannot call project api as No projectUrl provided in SANDBOX_CONFIG"))}getSessionId(){return this.sessionId}getSessionIdSubject(){return this.sessionIdSubject}internalPushChange(t){return this.listOfChanges.push(t),this.changeEmitter.next(t),Promise.resolve()}static#e=this.\u0275fac=function(n){return new(n||o)(e.\u0275\u0275inject(b.HttpClient),e.\u0275\u0275inject(d.CommonConfigService))};static#t=this.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),f=(()=>{class o{constructor(t,n,i,s){this.changeListener=t,this.valueService=n,this.schemaManager=i,this.changeManager=s,this.subscriptions=new c.Subscription,this.changesHistory=new c.ReplaySubject,this.subscriptions.add(t.getChangeEvents().subscribe(a=>{this.pushChange(a)}))}getJsonAt(t){return this.changeManager.getJsonAt(t)}pushChange(t){this.changeManager.pushChange(t),this.changesHistory.next(t)}findAndNotify(t,n){this.changeManager.findAndNotify(t,n)}getChangesHistory(){return this.changesHistory}receiveCommands(t,n){return this.changeManager.receiveCommands(t,n)}getSchemaManager(){return this.schemaManager}calculatePointerFor(t){return this.schemaManager.generateSchemaPointer(t)}close(){this.subscriptions.unsubscribe()}sendCommand(t){let n=null;return new Promise((i,s)=>{null!=t.running?(n=t.running.pipe((0,c.mergeAll)(1)).subscribe({complete:()=>i(),error:a=>s(a)}),this.subscriptions.add(n),this.pushChange(t),t.running.next(new Promise(a=>{t.running?.complete(),a()}))):s("No running observer in action")}).then(()=>{n?.unsubscribe()}).catch(()=>{n?.unsubscribe()})}static#e=this.\u0275fac=function(n){return new(n||o)(e.\u0275\u0275inject(C),e.\u0275\u0275inject(d.ValueService),e.\u0275\u0275inject(r.DontCodeSchemaManager),e.\u0275\u0275inject(r.DontCodeChangeManager))};static#t=this.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),y=(()=>{class o{static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275mod=e.\u0275\u0275defineNgModule({type:o});static#n=this.\u0275inj=e.\u0275\u0275defineInjector({imports:[m.CommonModule]})}return o})();class D extends r.DontCodeProject{}let A=(()=>{class o{static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275mod=e.\u0275\u0275defineNgModule({type:o});static#n=this.\u0275inj=e.\u0275\u0275defineInjector({imports:[m.CommonModule]})}return o})();var g=l(27022),P=l(49162);function Z(o,u){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"p"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2(" No handler found for position ",null==t.entityPointer?null:t.entityPointer.position," and schemaPosition ",null==t.entityPointer?null:t.entityPointer.positionInSchema," ")}}function Q(o,u){1&o&&e.\u0275\u0275elementContainer(0)}function X(o,u){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Q,1,0,"ng-container",8),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngTemplateOutlet",n.subFieldFullEditTemplate(t))}}function K(o,u){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"input",9),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("name",t.name)("formControlName",t.name)}}function q(o,u){if(1&o&&(e.\u0275\u0275elementStart(0,"div",5)(1,"label",6),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",7),e.\u0275\u0275template(4,X,2,1,"ng-container",0),e.\u0275\u0275template(5,K,2,2,"ng-container",0),e.\u0275\u0275elementEnd()()),2&o){const t=u.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("for",t.name),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.name),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",t.component),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.component)}}function ee(o,u){1&o&&e.\u0275\u0275elementContainer(0)}function te(o,u){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ee,1,0,"ng-container",8),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngTemplateOutlet",n.subFieldInlineViewTemplate(t))}}function ne(o,u){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(n.getData(t.name))}}function ie(o,u){if(1&o&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275text(1),e.\u0275\u0275template(2,te,2,1,"ng-container",0),e.\u0275\u0275template(3,ne,2,1,"ng-container",0),e.\u0275\u0275elementEnd()),2&o){const t=u.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" Value of ",t.name,": "),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.component),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.component)}}function oe(o,u){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"p"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"form",1)(4,"div",2),e.\u0275\u0275template(5,q,6,4,"div",3),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(8,ie,4,3,"div",4),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("You can edit the ",t.entityName," entity:"),e.\u0275\u0275advance(1),e.\u0275\u0275property("formGroup",t.form),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t.getSubFields()),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("The values of the ",t.entityName," entity are:"),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.getSubFields())}}let w=(()=>{class o extends d.PluginBaseComponent{constructor(t,n,i,s,a){super(t,n,i),this.fb=s,this.storeMgr=a,this.entityName="Unknown",null==this.storeMgr&&(this.storeMgr=r.dtcde.getStoreManager(),console.warn("DontCodeStoreManager not found by Angular's Injector")),this.form=this.fb.group({},{updateOn:"blur"})}ngOnInit(){null==this.value&&(this.value={}),this.updateValueOnFormChanges()}initCommandFlow(t,n){super.initCommandFlow(t,n),this.isEntity()&&(this.decomposeJsonToMultipleChanges(n,t.getJsonAt(n.position)),this.store=this.storeMgr.getProvider(n.position),null!=this.store&&this.store.loadEntity(n.position,null).then(i=>{this.setValue(i),this.rebuildForm(),this.ref.detectChanges()},i=>{console.error("Cannot load element with DefaultViewer because of error ",i)}),this.initChangeListening(),this.rebuildForm()),this.ref.detectChanges()}handleChange(t){this.entityPointer&&(t?.pointer?.positionInSchema===r.DontCodeModel.APP_FIELDS?this.updateSubFieldsWithChange(t,"fields").then(n=>{null!=n&&(this.ref.markForCheck(),this.ref.detectChanges())}):"name"===t?.pointer?.isSubItemOf(this.entityPointer)&&(this.entityName=t.value,this.ref.markForCheck(),this.ref.detectChanges()))}canProvide(t){throw new Error("Unsupported")}providesTemplates(t){throw new Error("Unsupported")}isEntity(){return r.DontCodeModel.APP_ENTITIES===this.entityPointer?.positionInSchema}getData(t){if(this.form.controls[t])return this.form.controls[t].value}static#e=this.\u0275fac=function(n){return new(n||o)(e.\u0275\u0275directiveInject(d.ComponentLoaderService),e.\u0275\u0275directiveInject(e.Injector),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(g.FormBuilder),e.\u0275\u0275directiveInject(r.DontCodeStoreManager))};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["dontcode-sandbox-default-viewer"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:3,vars:2,consts:[[4,"ngIf"],[3,"formGroup"],[1,"p-fluid"],["class","p-field p-grid",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"p-field","p-grid"],[1,"p-col-12","p-mb-2","p-md-2","p-mb-md-0",3,"for"],[1,"p-col-12","p-md-10"],[4,"ngTemplateOutlet"],["pInputText","",3,"name","formControlName"]],template:function(n,i){1&n&&(e.\u0275\u0275element(0,"dtcde-dynamic"),e.\u0275\u0275template(1,Z,3,2,"ng-container",0),e.\u0275\u0275template(2,oe,9,5,"ng-container",0)),2&n&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!i.isEntity()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.isEntity()))},dependencies:[m.NgForOf,m.NgIf,m.NgTemplateOutlet,d.DynamicInsertPoint,g.\u0275NgNoValidate,g.DefaultValueAccessor,g.NgControlStatus,g.NgControlStatusGroup,g.FormGroupDirective,g.FormControlName,P.InputText],changeDetection:0})}return o})();var se=l(83508),O=l.n(se);let F=(()=>{class o extends r.AbstractDontCodeStoreProvider{static forceCloseDatabase(){console.debug("IndexedDB: In forceCloseDatabase"),null!=this.globalDb&&(console.debug("IndexedDB: GlobalDB Exist"),this.globalDb.isOpen()&&(console.debug("IndexedDB: Closing GlobalDB"),this.globalDb.close(),console.debug("IndexedDB: GlobalDB is closed")))}static forceDeleteDatabase(t){return console.debug("IndexedDB: In forceDeleteDatabase"),O().delete(t).then(()=>{console.debug("IndexedDB: Database "+t+" deleted")})}constructor(t,n,i){super(i),this.values=t,this.configService=n,this.db=null,this.dbName="Dont-code Sandbox Lib",this.subscriptions=new c.Subscription,this.updateConfig(n.getConfig()),this.subscriptions.add(n.getUpdates().pipe((0,c.map)(s=>{this.updateConfig(s)})).subscribe()),null==self._indexedDbStorageServiceForceClose&&(self._indexedDbStorageServiceForceClose=()=>o.forceCloseDatabase()),null==self._indexedDbStorageServiceForceDelete&&(self._indexedDbStorageServiceForceDelete=s=>o.forceDeleteDatabase(s))}deleteEntity(t,n){return this.ensurePositionCanBeStored(t,!1).then(i=>i.delete(n).then(()=>!0))}loadEntity(t,n){return this.ensurePositionCanBeStored(t,!1).then(i=>i.get(n)).catch(i=>{console.warn("IndexedDB: Cannot load entity "+n+" : "+i)})}searchEntities(t,...n){return(0,c.from)(this.ensurePositionCanBeStored(t,!1).then(i=>i.toArray().then(s=>r.StoreProviderHelper.applyFilters(s,...n))).catch(i=>(console.warn("IndexedDB: Cannot search entity: "+i),[])))}canStoreDocument(t){return!1}storeDocuments(t,n){throw new Error("Impossible to store documents in IndexedDB.")}storeEntity(t,n){return this.ensurePositionCanBeStored(t,!0).then(i=>i.put(n).then(s=>n._id&&n._id!==s?Promise.reject("Stored entity with id "+s+" different from "+n._id):n))}ensurePositionCanBeStored(t,n){const i=this.values.findAtPosition(t);return i?this.ensureEntityCanBeStored(i,n):Promise.reject("Error called with null description")}ensureEntityCanBeStored(t,n){return this.withDatabase().then(i=>{let s;try{s=i.table(t.name)}catch{}if(null!=s)return Promise.resolve(s);if(n){const a={};return a[t.name]="++_id",this.changeSchema(i,a).then(p=>p.table(t.name))}return Promise.reject(t.name+" table not found")})}changeSchema(t,n){return t.close(),t.version(t.verno+1).stores(n),t.open().then(i=>i)}updateConfig(t){null!=t.indexedDbName&&t.indexedDbName.length>0&&t.indexedDbName!=this.dbName&&(this.dbName=t.indexedDbName,this.db?.isOpen()&&(console.warn("Changing the name of an Open IndexedDB database to "+t.indexedDbName),this.db.close(),this.db=null),o.forceCloseDatabase())}withDatabase(){return null!=this.db||(null==o.globalDb&&(o.globalDb=new(O())(this.dbName,{allowEmptyDB:!0,autoOpen:!1})),this.db=o.globalDb,this.db.isOpen())?Promise.resolve(this.db):this.db.open().then(t=>t)}ngOnDestroy(){this.subscriptions.unsubscribe(),o.forceCloseDatabase()}allTables(t){let n="";for(const i of t.tables)n=n+", "+i.name;return n}static#e=this.\u0275fac=function(n){return new(n||o)(e.\u0275\u0275inject(d.ValueService),e.\u0275\u0275inject(d.CommonConfigService),e.\u0275\u0275inject(r.DontCodeModelManager,8))};static#t=this.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var T=l(15861),re=l(93630);let V=(()=>{class o{constructor(t,n,i){this.compLoader=t,this.injector=n,this.httpClient=i,this.repository=null}loadPluginsFromRepository(t,n){return void 0===t?Promise.resolve({name:"No Repository",plugins:[]}):(console.debug("Loading plugins"),new Promise((i,s)=>{try{if(this.repository=t,null!=this.repository?.plugins){const a=new Array;for(const p of this.repository.plugins)a.push(this.createRemotePluginConfig(p,n));console.debug("Loading following plugins",this.repository.plugins),this.loadMultipleModules(a).then(()=>{null!=this.repository?i(this.repository):s("No repository loaded")}).catch(p=>{s(p)})}}catch(a){return console.error("Cannot load repository config from "+n+" due to error ",a),s(a)}}))}createRemotePluginConfig(t,n){let i;const s=t.id.substring(0,1).toUpperCase()+t.id.substring(1);return i=null!=t.info?{type:"module",moduleId:t.id,exposedModule:t.info["exposed-module"]??"./"+s,remoteEntry:t.info["remote-entry"]??n+"/remoteEntry.mjs"}:{type:"module",moduleId:t.id,exposedModule:"./"+s,remoteEntry:n+"/remoteEntry.mjs"},i}listAllRepositoryConfigUpdates(){const t=new Array;return this.repository?.plugins?.forEach(n=>{null!=n.config&&null!=n.config["definition-updates"]&&n.config["definition-updates"].forEach(i=>{t.push(i)})}),t}loadModule(t){var n=this;return(0,T.Z)(function*(){return yield(0,re.loadRemoteModule)(t),(yield n.compLoader.getOrCreatePluginModuleRef(t.moduleId.toLowerCase())).instance})()}loadMultipleModules(t){var n=this;return(0,T.Z)(function*(){const i=new Array;for(const s of t)try{const a=yield n.loadModule(s);i.push(a)}catch(a){console.error("Error loading plugin "+s.moduleId,a)}return i})()}static#e=this.\u0275fac=function(n){return new(n||o)(e.\u0275\u0275inject(d.ComponentLoaderService),e.\u0275\u0275inject(e.Injector),e.\u0275\u0275inject(b.HttpClient))};static#t=this.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var h=l(2369);let R=(()=>{class o{constructor(t,n,i){this.loader=t,this.changeService=n,this.previewManager=i,this.subscribers=new c.Subscriber,this.cachedHandlers=new Map}initLoading(){this.subscribers.add(this.previewManager.receiveGlobalHandlers().pipe((0,h.mergeMap)(t=>this.loader.loadPluginModule(t).then(n=>({config:t,moduleRef:n}))),(0,h.mergeMap)(t=>{const n=t.moduleRef.instance.exposedPreviewHandlers().get(t.config.class.name);return this.changeService.receiveCommands(t.config.location.parent,t.config.location.id).pipe((0,h.map)(i=>({clazz:n,moduleRef:t.moduleRef,change:i})))}),(0,h.map)(t=>{let n=this.cachedHandlers.get(t.clazz);return n||(n=t.moduleRef.injector.get(t.clazz),this.cachedHandlers.set(t.clazz,n),n.initCommandFlow(this.changeService,t.change.pointer??this.changeService.calculatePointerFor(t.change.position)),n.handleChange(t.change)),n})).subscribe({error:t=>{console.error("Error loading global handler",t)}}))}close(){this.subscribers.unsubscribe()}static#e=this.\u0275fac=function(n){return new(n||o)(e.\u0275\u0275inject(d.ComponentLoaderService),e.\u0275\u0275inject(f),e.\u0275\u0275inject(r.DontCodePreviewManager))};static#t=this.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),x=(()=>{class o{static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275mod=e.\u0275\u0275defineNgModule({type:o});static#n=this.\u0275inj=e.\u0275\u0275defineInjector({imports:[m.CommonModule,y,A,d.PluginCommonModule,g.ReactiveFormsModule,P.InputTextModule]})}return o})();var I=l(84774),L=l(39366),k=l(42736),_=l(24504),B=l(56956),ae=l(51411),U=l(69949),le=l(3134);let ce=(()=>{class o{constructor(t,n,i,s,a){this.provider=t,this.ref=i,this.router=s,this.ngZone=a,this.templateMenus=new Array({label:"Main Menu",items:[{label:"Home",icon:"pi pi-home",routerLink:["/"]},{label:"Dev",icon:"pi pi-book",routerLink:["dev"]}]},{label:"Application Menu",items:new Array}),this.subscriptions=new c.Subscription,this.runtime=!1;const p=window.dontCodeConfig;(!0===p?.runtime||null!=p?.projectId)&&(this.runtime=!0),null!=n&&null!=this.templateMenus[0].items&&this.templateMenus[0].items.push(...n.additionalMenus()),this.menus=this.generateMenu()}ngOnInit(){this.handleItemMenu(r.DontCodeModel.APP_ENTITIES,r.DontCodeModel.APP_ENTITIES_NAME_NODE,"pi-ticket"),this.handleItemMenu(r.DontCodeModel.APP_SCREENS,r.DontCodeModel.APP_SCREENS_NAME_NODE,"pi-desktop"),this.handleItemMenu(r.DontCodeModel.APP_REPORTS,r.DontCodeModel.APP_REPORTS_TITLE_NODE,"pi-chart-pie")}handleItemMenu(t,n,i){this.subscriptions.add(this.provider.receiveCommands(t,n).pipe((0,h.map)(s=>{s.type!=r.ChangeType.ACTION&&(this.updateMenuName(s,i),this.ref.detectChanges())})).subscribe()),this.subscriptions.add(this.provider.receiveCommands(t+"/?").pipe((0,h.map)(s=>{s.type!=r.ChangeType.ACTION&&(s.position.length>t.length+1?(this.updateMenu(s,n,i),this.ref.detectChanges()):s.value||(this.getDynamicMenu().length=0,this.ref.detectChanges()))})).subscribe())}getDynamicMenu(){return this.templateMenus[1].items?this.templateMenus[1].items:[]}generateMenu(){const t=new Array;return this.runtime?(this.getDynamicMenu().forEach(n=>{t.push(n)}),0===t.length&&t.push(this.templateMenus[1])):this.templateMenus.forEach(n=>{t.push(n)}),t}ngOnDestroy(){this.subscriptions.unsubscribe()}gotoPage(t){this.ngZone.run(()=>{this.router.navigate([t])})}isActive(t){return this.router.isActive(t,!0)}cleanPosition(t){return t.endsWith(r.DontCodeModel.APP_SCREENS_NAME_NODE)&&(t=t.substring(0,t.length-r.DontCodeModel.APP_SCREENS_NAME_NODE.length-1)),t}updateMenu(t,n,i){if(t.type==r.ChangeType.ACTION)return;const s=t.position,a=this.findMenuPosOf(s);let p;if(-1===a){if(null==t.value?.[n])return;p={routerLink:[s],label:t.value[n],icon:"pi "+i}}else p=this.getDynamicMenu()[a];switch(t.type){case r.ChangeType.UPDATE:case r.ChangeType.RESET:case r.ChangeType.ADD:case r.ChangeType.DELETE:break;case r.ChangeType.MOVE:{-1!==a&&this.getDynamicMenu().splice(a,1);let v=-1;t.pointer&&(v=this.findMenuPosOf(t.pointer.containerPosition+"/"+t.beforeKey)),-1!==v?this.getDynamicMenu().splice(v,0,p):this.getDynamicMenu().push(p)}this.menus=this.generateMenu()}}updateMenuName(t,n){if(t.type==r.ChangeType.ACTION)return;const i=r.DontCodeModelPointer.parentPosition(t.position);if(null==i)return void console.error("Cannot update menu name for "+t.position+" with no parent position");const s=this.cleanPosition(i),a=this.findMenuPosOf(s),p=t.value;let v;switch(v=-1===a?{routerLink:[s],label:t.value,icon:"pi "+n}:this.getDynamicMenu()[a],t.type){case r.ChangeType.UPDATE:case r.ChangeType.RESET:case r.ChangeType.ADD:-1!==a?v.label=p:this.getDynamicMenu().push(v);break;case r.ChangeType.DELETE:-1!==a&&this.getDynamicMenu().splice(a,1)}this.menus=this.generateMenu()}findMenuPosOf(t){let n=-1;return this.getDynamicMenu().forEach((i,s)=>{i.routerLink[0]===t&&(n=s)}),n}static#e=this.\u0275fac=function(n){return new(n||o)(e.\u0275\u0275directiveInject(f),e.\u0275\u0275directiveInject(d.SANDBOX_MENUS,8),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(I.Router),e.\u0275\u0275directiveInject(e.NgZone))};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["dontcode-sandbox-menu"]],decls:2,vars:1,consts:[[1,"grid"],[1,"col",3,"model"]],template:function(n,i){1&n&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"p-menu",1),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("model",i.menus))},dependencies:[B.Menu],changeDetection:0})}return o})();function de(o,u){if(1&o&&(e.\u0275\u0275elementStart(0,"div",14)(1,"div",18),e.\u0275\u0275text(2,"Server:"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",19),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",18),e.\u0275\u0275text(6,"Session:"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div",19),e.\u0275\u0275text(8),e.\u0275\u0275elementEnd()()),2&o){const t=e.\u0275\u0275nextContext().ngIf,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(n.serverUrl),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(t.sessionId)}}const ue=function(){return{width:"500px"}},pe=function(){return{width:"15em"}};function he(o,u){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"p-toolbar",1)(2,"div",2)(3,"button",3),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(i.sidePanelVisible=!i.sidePanelVisible)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"a",4),e.\u0275\u0275element(5,"img",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"h1"),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"div",6)(9,"button",7),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(i.openDevUrl())}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"button",8),e.\u0275\u0275listener("mouseenter",function(i){e.\u0275\u0275restoreView(t);const s=e.\u0275\u0275reference(12);return e.\u0275\u0275resetView(s.show(i))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"p-overlayPanel",9,10),e.\u0275\u0275template(13,de,9,2,"ng-template",11),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(14,"div",12)(15,"p-sidebar",13),e.\u0275\u0275listener("visibleChange",function(i){e.\u0275\u0275restoreView(t);const s=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(s.sidePanelVisible=i)}),e.\u0275\u0275elementStart(16,"a",4),e.\u0275\u0275element(17,"img",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(18,"dontcode-sandbox-menu"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(19,"div",14)(20,"div",15),e.\u0275\u0275element(21,"dontcode-sandbox-menu",16),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(22,"div",17),e.\u0275\u0275element(23,"router-outlet"),e.\u0275\u0275elementEnd()()()}if(2&o){const t=u.ngIf,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(5),e.\u0275\u0275property("src",n.themedLogo(),e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(n.appName),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngClass",n.connectedClass(t)),e.\u0275\u0275advance(1),e.\u0275\u0275styleMap(e.\u0275\u0275pureFunction0(13,ue)),e.\u0275\u0275property("showCloseIcon",!1),e.\u0275\u0275advance(4),e.\u0275\u0275styleMap(e.\u0275\u0275pureFunction0(14,pe)),e.\u0275\u0275property("visible",n.sidePanelVisible)("modal",!1)("closeOnEscape",!0)("showCloseIcon",!0),e.\u0275\u0275advance(2),e.\u0275\u0275property("src",n.themedLogo(),e.\u0275\u0275sanitizeUrl)}}let me=(()=>{class o{constructor(t,n,i,s){this.provider=t,this.listenerService=n,this.configService=i,this.ref=s,this.context$=c.EMPTY,this.subscriptions=new c.Subscription,this.appName="Plugin Tester",this.serverUrl="",this.config=null,this.sidePanelVisible=!0}ngOnInit(){this.subscriptions.add(this.configService.getUpdates().subscribe(t=>{t.applicationName!=this.config?.applicationName&&null!=t.applicationName&&(this.appName=t.applicationName),t.webSocketUrl!=this.config?.webSocketUrl&&null!=t.webSocketUrl&&t.webSocketUrl.length>0&&(this.serverUrl=t.webSocketUrl),this.config=t})),this.subscriptions.add(this.provider.receiveCommands(r.DontCodeModel.APP_NAME).subscribe(t=>{this.appName=this.generateApplicationName(t.value?t.value:"No Name"),this.ref.detectChanges()})),this.context$=(0,c.combineLatest)([this.listenerService.getConnectionStatus(),this.listenerService.getSessionIdSubject()]).pipe((0,h.map)(t=>({status:t[0],sessionId:t[1]})))}ngOnDestroy(){this.subscriptions.unsubscribe()}logoClicked(){this.sidePanelVisible=!0}sidePanelVisibleChanged(t){this.sidePanelVisible=t.target.visible}openDevUrl(){window.open("#/newTabDev","_blank")}connectedClass(t){return"undefined"===t.status?"p-button-secondary":"connected"!==t.status?"p-button-danger":""}generateApplicationName(t){return this.config?.applicationName?this.config?.applicationName+" "+t:t}themedLogo(){return this.config?.theme?"assets/images/logo-"+this.config?.theme+".png":"assets/images/logo.png"}static#e=this.\u0275fac=function(n){return new(n||o)(e.\u0275\u0275directiveInject(f),e.\u0275\u0275directiveInject(C),e.\u0275\u0275directiveInject(d.CommonConfigService),e.\u0275\u0275directiveInject(e.ChangeDetectorRef))};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["dontcode-sandbox-main"]],decls:2,vars:3,consts:[[4,"ngIf"],["id","mainToolbar"],[1,"p-toolbar-group-left"],["pButton","","type","button","icon","pi pi-bars",1,"md:hidden","p-button-rounded","p-button-outlined",2,"margin-right","10px",3,"click"],["href","https://dont-code.net/apps.html"],["width","119","height","66",3,"src"],[1,"p-toolbar-group-right"],["pButton","","type","button","icon","pi pi-external-link",1,"p-button-rounded","p-button-outlined",3,"click"],["pButton","","type","button","icon","pi pi-sort",1,"p-button-rounded","p-button-outlined",3,"ngClass","mouseenter"],[3,"showCloseIcon"],["op",""],["pTemplate",""],[1,"md:hidden"],["id","mainSidePanel",3,"visible","modal","closeOnEscape","showCloseIcon","visibleChange"],[1,"grid"],[1,"col","hidden","md:block","md:col-3"],["id","mainMenu"],[1,"col","md:col-9"],[1,"col-2"],[1,"col-10"]],template:function(n,i){1&n&&(e.\u0275\u0275template(0,he,24,15,"div",0),e.\u0275\u0275pipe(1,"async")),2&n&&e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(1,1,i.context$))},dependencies:[m.NgClass,m.NgIf,I.RouterOutlet,L.Sidebar,le.PrimeTemplate,k.Toolbar,_.ButtonDirective,U.OverlayPanel,ce,m.AsyncPipe],styles:[".sidenav-container[_ngcontent-%COMP%]{height:100%}.sidenav[_ngcontent-%COMP%]{width:200px}.sidenav[_ngcontent-%COMP%]   .mat-toolbar[_ngcontent-%COMP%]{background:inherit}.mat-toolbar.mat-primary[_ngcontent-%COMP%]{position:sticky;top:0;z-index:1}"],changeDetection:0})}return o})(),fe=(()=>{class o{constructor(t,n,i,s,a,p,v,De,Pe,we,Te,je,Ne,Ae){this.provider=t,this.storage=n,this.listener=i,this.pluginLoader=s,this.globalPluginLoader=a,this.loaderService=p,this.changeProviderService=v,this.configService=De,this.httpClient=Pe,this.injector=we,this.dontCodeCore=Te,this.modelMgr=je,this.storeMgr=Ne,this.previewMgr=Ae,this.subscription=new c.Subscription,this.sessionId=null,this.runtimeConfig=new H}ngOnInit(){let t=this.runtimeConfig.repositoryUrl;null==t&&(t="assets/repositories/default.json"),(0,c.firstValueFrom)(this.httpClient.get(t,{observe:"body",responseType:"json"})).then(n=>{const i={};null!=n.documentApiUrl&&(i.documentApiUrl=n.documentApiUrl),null!=n.storeApiUrl&&(i.storeApiUrl=n.storeApiUrl),null!=n.webSocketUrl&&(i.webSocketUrl=n.webSocketUrl),null!=n.projectApiUrl&&(i.projectApiUrl=n.projectApiUrl),this.configService.batchUpdateConfig(i),this.pluginsLoaded=this.pluginLoader.loadPluginsFromRepository(n,t).catch(s=>this.runtimeConfig.forceRepositoryLoading?Promise.reject(s):Promise.resolve(null)).then(s=>{this.dontCodeCore.initPlugins(),this.pluginLoader.listAllRepositoryConfigUpdates().forEach(p=>{const v=this.modelMgr.convertToChange(p);this.changeProviderService.pushChange(v)})}),console.info("Dynamic Plugins inited"),this.globalPluginLoader.initLoading(),this.storeMgr.setProvider(this.storage),this.subscription.add(this.provider.receiveCommands(r.DontCodeModel.APP_SHARING,r.DontCodeModel.APP_SHARING_WITH_NODE).pipe((0,h.mergeMap)(s=>s.type!==r.ChangeType.DELETE?"No-one"===s.value?(this.storeMgr.setProvider(this.storage),c.EMPTY):s.value?this.loadStoreManager(r.DontCodeModel.APP_SHARING_WITH):c.EMPTY:c.EMPTY),(0,h.map)(s=>{if(null!=s){const a=e.Injector.create({providers:[s],parent:this.injector});this.storeMgr.setProvider(a.get(s)),console.info("Set new provider to:",s)}return s})).subscribe({error(s){console.error("Cannot load StoreProvider due to",s)}})),this.sessionId=this.runtimeConfig.sessionId??null,console.info("Browser opened with SessionId =",this.sessionId),this.listener.setSessionId(this.sessionId)})}loadStoreManager(t){const n=this.provider.getJsonAt(t),i=this.previewMgr.retrieveHandlerConfig(t,n);return i?(console.debug("Importing StoreManager from ",i.class.source),this.loaderService.loadPluginModule(i).then(s=>{const a=s.instance.exposedPreviewHandlers().get(i.class.name);return console.debug("Provider Class found:",a),a})):Promise.reject("No handler found for storemanager "+n)}mainTab(){return-1===window.location.hash.indexOf("/newTabDev")}ngOnDestroy(){this.subscription.unsubscribe()}static#e=this.\u0275fac=function(n){return new(n||o)(e.\u0275\u0275directiveInject(f),e.\u0275\u0275directiveInject(F),e.\u0275\u0275directiveInject(C),e.\u0275\u0275directiveInject(V),e.\u0275\u0275directiveInject(R),e.\u0275\u0275directiveInject(d.ComponentLoaderService),e.\u0275\u0275directiveInject(f),e.\u0275\u0275directiveInject(d.CommonConfigService),e.\u0275\u0275directiveInject(b.HttpClient),e.\u0275\u0275directiveInject(e.Injector),e.\u0275\u0275directiveInject(d.DONT_CODE_CORE),e.\u0275\u0275directiveInject(r.DontCodeModelManager),e.\u0275\u0275directiveInject(r.DontCodeStoreManager),e.\u0275\u0275directiveInject(r.DontCodePreviewManager))};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ng-component"]],decls:0,vars:0,template:function(n,i){},encapsulation:2})}return o})();class H{constructor(){this.runtime=!1,this.forceRepositoryLoading=!1}}let j=(()=>{class o{static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275mod=e.\u0275\u0275defineNgModule({type:o});static#n=this.\u0275inj=e.\u0275\u0275defineInjector({imports:[m.CommonModule,I.RouterModule,L.SidebarModule,k.ToolbarModule,_.ButtonModule,B.MenuModule,ae.TooltipModule,U.OverlayPanelModule]})}return o})();var N=l(37981),G=l(7471),ge=l(97822),W=l(30178),z=l(46674);let ve=(()=>{class o{static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275mod=e.\u0275\u0275defineNgModule({type:o});static#n=this.\u0275inj=e.\u0275\u0275defineInjector({imports:[m.CommonModule,x,N.AccordionModule,G.AutoCompleteModule,ge.PanelModule,P.InputTextModule,g.ReactiveFormsModule,W.InputTextareaModule,_.ButtonModule,z.DropdownModule,d.PluginCommonModule]})}return o})(),Ce=(()=>{class o{static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["dontcode-sandbox-home"]],decls:24,vars:0,consts:[["pButton","","type","button","icon","pi pi-sort",1,"p-button-rounded","p-button-outlined","p-button-secondary"],["pButton","","type","button","icon","pi pi-sort",1,"p-button-rounded","p-button-outlined","p-button-danger"]],template:function(n,i){1&n&&(e.\u0275\u0275elementStart(0,"h1"),e.\u0275\u0275text(1,"Welcome to DontCode !"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(2,"h2"),e.\u0275\u0275text(3,"What am I seeing ?"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"p"),e.\u0275\u0275text(5,"You have opened the Preview App. The Preview App connects to Online services to receive Application changes from the Application Builder in realtime."),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p")(7,"b"),e.\u0275\u0275text(8,"Check you are connected"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(9," to the online service by looking at the "),e.\u0275\u0275element(10,"button",0),e.\u0275\u0275text(11," icon in the header panel."),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"p"),e.\u0275\u0275element(13,"button",0),e.\u0275\u0275text(14," means you are ok, "),e.\u0275\u0275element(15,"button",1),e.\u0275\u0275text(16," you have connection issue to the online service. Please check the browser log in this case"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"p"),e.\u0275\u0275text(18,"If "),e.\u0275\u0275element(19,"button",0),e.\u0275\u0275text(20,", then "),e.\u0275\u0275elementStart(21,"b"),e.\u0275\u0275text(22,"go back to the Application Builder"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(23," and enter some values in the Editor"),e.\u0275\u0275elementEnd())},dependencies:[_.ButtonDirective],styles:["button[_ngcontent-%COMP%]{vertical-align:middle}"]})}return o})();function be(o,u){if(1&o&&(e.\u0275\u0275elementStart(0,"p"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"json"),e.\u0275\u0275elementEnd()),2&o){const t=u.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate3("",t.type,", ",t.position,", ",e.\u0275\u0275pipeBind1(2,3,t.value?t.value:t.beforeKey),"")}}let ye=(()=>{class o{constructor(t,n){this.changeProvider=t,this.ref=n,this.subscriptions=new c.Subscription,this.commands=[],this.forgetIt=!0}ngOnInit(){this.subscriptions.add(this.changeProvider.getChangesHistory().pipe((0,h.map)(t=>{this.commands.push(structuredClone(t)),this.ref.detectChanges()})).subscribe())}noCommands(){return 0==this.commands.length}ngOnDestroy(){this.subscriptions.unsubscribe()}static#e=this.\u0275fac=function(n){return new(n||o)(e.\u0275\u0275directiveInject(f),e.\u0275\u0275directiveInject(e.ChangeDetectorRef))};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["dontcode-sandbox-list-commands"]],decls:3,vars:1,consts:[[4,"ngFor","ngForOf"]],template:function(n,i){1&n&&(e.\u0275\u0275elementStart(0,"p"),e.\u0275\u0275text(1,"We list below the commands received from the Application Builder:"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(2,be,3,5,"p",0)),2&n&&(e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",i.commands))},dependencies:[m.NgForOf,m.JsonPipe],changeDetection:0})}return o})(),Se=(()=>{class o{constructor(t){this.listener=t,this.channel=new S.BroadcastChannel(d.CHANNEL_CHANGE_NAME)}pushChange(t){return this.listener.internalPushChange(t)}static#e=this.\u0275fac=function(n){return new(n||o)(e.\u0275\u0275inject(C))};static#t=this.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),Me=(()=>{class o{constructor(t,n){this.http=t,this.configService=n,this.templates=[]}getTemplates(){if(this.templates.length>0)return(0,c.of)(this.templates);{let t=this.configService.getConfig()?.templateFileUrl;return t||(t="assets/dev/default-templates.json"),this.http.get(t,{responseType:"json"}).pipe((0,h.map)(n=>{this.templates=new Array;const i=n;for(const s of i)this.templates.push(new Ie(s));return this.templates}),(0,h.catchError)(n=>{throw console.log("Error reading Dev templates file",n),n}))}}filterTemplates(t){return t=t.toLowerCase(),this.getTemplates().pipe((0,h.map)(n=>n.filter(s=>!!s.name.toLowerCase().startsWith(t))))}static#e=this.\u0275fac=function(n){return new(n||o)(e.\u0275\u0275inject(b.HttpClient),e.\u0275\u0275inject(d.CommonConfigService))};static#t=this.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();class Ie{constructor(u){if(this.name=u.name,this.sequence=[],void 0!==u.position)this.sequence.push(new $(u.position,u.type,u.value));else for(const t of u.sequence)this.sequence.push(new $(t.position,t.type,t.value))}isSequence(){return!!this.sequence&&this.sequence.length>1}}class ${constructor(u,t,n){this.position=u,this.type=t,this.value=n}isValid(){return null!=this.position&&null!=this.type}}let _e=(()=>{class o{constructor(t,n,i){this.pushService=t,this.templates=n,this.fb=i,this.position="creation/name",this.value="New Test",this.subscriptions=new c.Subscription,this.listTemplates=[],this.filteredTemplates=[],this.templateForm=this.fb.group({template:null,step:null,type:null,value:null}),this.filteredSteps=[],this.selectedStep=null,this.valueFieldLabel="Value",this.changeTypes=[{label:r.ChangeType.ADD},{label:r.ChangeType.UPDATE},{label:r.ChangeType.DELETE},{label:r.ChangeType.MOVE},{label:r.ChangeType.RESET}],this.openAddCommand=!0}ngOnInit(){this.subscriptions.add(this.templates.getTemplates().pipe((0,h.map)(t=>{this.listTemplates=t})).subscribe()),this.subscriptions.add(this.templateForm.get("template")?.valueChanges.pipe((0,h.map)(t=>{const n=this.templateForm.get("step"),i=this.templateForm.get("type");if(null==n||null==i)throw new Error("Cannot find value and type field");null!=t?(this.filteredSteps=t.sequence,n.setValue(t.sequence[0]),n.enable({emitEvent:!1}),i.setValue(t.sequence[0].type)):(n.setValue(null),n.disable({emitEvent:!1}),i.setValue(null))})).subscribe()),this.subscriptions.add(this.templateForm.get("step")?.valueChanges.pipe((0,h.map)(t=>{const n=this.templateForm.get("value"),i=this.templateForm.get("type");if(null==n||null==i)throw new Error("Cannot find value and type field");null===t?(n.disable({emitEvent:!1}),i.disable({emitEvent:!1})):(n.enable({emitEvent:!1}),i.enable({emitEvent:!1})),"string"==typeof t?(this.templateForm.get("template")?.setValue(null,{emitEvent:!1}),null!=this.selectedStep&&(this.selectedStep.position=t)):(this.selectedStep=t,null!=t&&(i.setValue(t.type),n.setValue("string"==typeof t.value?t.value:JSON.stringify(t.value,null,2))))})).subscribe()),this.subscriptions.add(this.templateForm.get("value")?.valueChanges.pipe((0,h.map)(t=>{const n=this.getSelectedStep();if(null!=n)if(null==t)n.value=t;else try{n.value=JSON.parse(t)}catch{n.value=t}})).subscribe()),this.subscriptions.add(this.templateForm.get("type")?.valueChanges.pipe((0,h.map)(t=>{const n=this.getSelectedStep();null!=n&&(n.type=t??""),this.valueFieldLabel=t===r.ChangeType.MOVE?"Before":"Value"})).subscribe())}ngOnDestroy(){this.subscriptions.unsubscribe()}sendCommand(){var t=this;return(0,T.Z)(function*(){const n=t.getSelectedTemplate();if(null!=n)for(const i of n.sequence)i.isValid()&&(yield t.pushChange(i.type,i.position,i.value));else{const i=t.getSelectedStep();null!=i&&i.isValid()&&(yield t.pushChange(i.type,i.position,i.value))}})()}searchTemplate(t){this.subscriptions.add(this.templates.filterTemplates(t.query).pipe((0,h.map)(n=>{this.filteredTemplates=n})).subscribe())}getSelectedTemplate(){return this.templateForm.get("template")?.value??null}getSelectedStep(){return this.selectedStep}searchStep(t){const n=t.query.toLowerCase(),i=this.getSelectedTemplate()?.sequence;this.filteredSteps=i?i.filter(s=>!!s.position.toLowerCase().startsWith(n)):[]}pushChange(t,n,i){"/"===n&&(n="");const s=new r.Change(r.ChangeType[t],n,i);return t===r.ChangeType.MOVE&&(s.value=null,s.oldPosition=n,s.beforeKey=i),this.pushService.pushChange(s)}static#e=this.\u0275fac=function(n){return new(n||o)(e.\u0275\u0275directiveInject(Se),e.\u0275\u0275directiveInject(Me),e.\u0275\u0275directiveInject(g.FormBuilder))};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["dontcode-sandbox-insert-command"]],decls:26,vars:9,consts:[["header","Add Command",3,"selected"],[1,"p-fluid","formgrid","grid",3,"formGroup"],[1,"field","col-12","md:col-9"],[1,"p-float-label"],["id","template","formControlName","template","field","name",3,"suggestions","dropdown","completeMethod"],["for","template"],[1,"field","col-12","md:col-3"],["id","sendButton","label","Send",3,"click"],["id","step","formControlName","step","field","position",3,"suggestions","dropdown","completeMethod"],["for","step"],["id","type","formControlName","type","field","type","optionValue","label",3,"options"],["for","type"],[1,"field","col-12"],["pInputTextarea","","id","value","formControlName","value","field","value","rows","10",3,"autoResize"],["for","value"]],template:function(n,i){1&n&&(e.\u0275\u0275elementStart(0,"p-accordion")(1,"p-accordionTab",0)(2,"div",1)(3,"div",2)(4,"span",3)(5,"p-autoComplete",4),e.\u0275\u0275listener("completeMethod",function(a){return i.searchTemplate(a)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"label",5),e.\u0275\u0275text(7,"Select a Template"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(8,"div",6)(9,"p-button",7),e.\u0275\u0275listener("click",function(){return i.sendCommand()}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(10,"div",2)(11,"span",3)(12,"p-autoComplete",8),e.\u0275\u0275listener("completeMethod",function(a){return i.searchStep(a)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"label",9),e.\u0275\u0275text(14,"Step"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(15,"div",6)(16,"span",3),e.\u0275\u0275element(17,"p-dropdown",10),e.\u0275\u0275elementStart(18,"label",11),e.\u0275\u0275text(19,"Select a type"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(20,"div",12)(21,"span",3)(22,"textarea",13),e.\u0275\u0275text(23,"          "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(24,"label",14),e.\u0275\u0275text(25),e.\u0275\u0275elementEnd()()()()()()),2&n&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("selected",i.openAddCommand),e.\u0275\u0275advance(1),e.\u0275\u0275property("formGroup",i.templateForm),e.\u0275\u0275advance(3),e.\u0275\u0275property("suggestions",i.filteredTemplates)("dropdown",!0),e.\u0275\u0275advance(7),e.\u0275\u0275property("suggestions",i.filteredSteps)("dropdown",!0),e.\u0275\u0275advance(5),e.\u0275\u0275property("options",i.changeTypes),e.\u0275\u0275advance(5),e.\u0275\u0275property("autoResize",!0),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(i.valueFieldLabel))},dependencies:[N.Accordion,N.AccordionTab,G.AutoComplete,g.DefaultValueAccessor,g.NgControlStatus,g.NgControlStatusGroup,g.FormGroupDirective,g.FormControlName,W.InputTextarea,_.Button,z.Dropdown]})}return o})(),J=(()=>{class o{static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["dontcode-sandbox-debug-page"]],decls:12,vars:0,consts:[[1,"grid","flex-column"],[1,"col"]],template:function(n,i){1&n&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"h1"),e.\u0275\u0275text(3,"Debug Page"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"br"),e.\u0275\u0275text(5,"This page allows us to test your plugin by injecting the same commands than the Builder application. "),e.\u0275\u0275element(6,"br"),e.\u0275\u0275text(7,"You then can see the behavior of your Preview Plugin without running the Builder "),e.\u0275\u0275element(8,"br"),e.\u0275\u0275text(9," Please select the command to add: "),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(10,"dontcode-sandbox-insert-command",1)(11,"dontcode-sandbox-list-commands",1),e.\u0275\u0275elementEnd())},dependencies:[ye,_e]})}return o})();const Ee=[{path:"",component:Ce},{path:"dev",component:J},{path:"newTabDev",component:J},{path:"creation/:type/:id",component:(()=>{class o{constructor(t,n,i,s){this.route=t,this.provider=n,this.loader=i,this.injector=s,this.subscriptions=new c.Subscription,this.screenName$=c.EMPTY}ngOnInit(){this.screenName$=this.route.params}ngOnDestroy(){this.subscriptions.unsubscribe()}ngAfterViewInit(){this.subscriptions.add(this.route.url.pipe((0,h.map)(t=>{let n=null;if(t.forEach(i=>{n=null===n?i.path:n+"/"+i.path}),null==n)throw new Error("No position in route to screen");if(null==this.provider)throw new Error("No provider");try{const i=this.provider.calculatePointerFor(n);this.dynamicInsertPoint.clear(),this.loader.insertComponent(i,this.dynamicInsertPoint,this.provider.getJsonAt(n)).then(s=>{null==s&&this.loader.createComponent(w,this.dynamicInsertPoint,void 0,i)})}catch(i){console.warn("Error creating component for "+n+":",i),this.loader.createComponent(w,this.dynamicInsertPoint,void 0,new r.DontCodeModelPointer(n,n))}})).subscribe())}providesTemplates(t){throw new Error("Method not implemented.")}canProvide(t){throw new Error("Method not implemented.")}static#e=this.\u0275fac=function(n){return new(n||o)(e.\u0275\u0275directiveInject(I.ActivatedRoute),e.\u0275\u0275directiveInject(f),e.\u0275\u0275directiveInject(d.ComponentLoaderService),e.\u0275\u0275directiveInject(e.Injector))};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["dontcode-sandbox-screen"]],viewQuery:function(n,i){if(1&n&&e.\u0275\u0275viewQuery(d.DynamicInsertPoint,5,e.ViewContainerRef),2&n){let s;e.\u0275\u0275queryRefresh(s=e.\u0275\u0275loadQuery())&&(i.dynamicInsertPoint=s.first)}},decls:1,vars:0,template:function(n,i){1&n&&e.\u0275\u0275element(0,"dtcde-dynamic")},dependencies:[d.DynamicInsertPoint]})}return o})()}];let xe=(()=>{class o{static forRoot(t){return{ngModule:o,providers:[{provide:d.DONT_CODE_COMMON_CONFIG,useValue:t}]}}static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275mod=e.\u0275\u0275defineNgModule({type:o});static#n=this.\u0275inj=e.\u0275\u0275defineInjector({providers:[{provide:d.COMMAND_PROVIDER,useExisting:f}],imports:[x,j,ve,I.RouterModule.forChild(Ee),x,j]})}return o})()},15861:(Y,E,l)=>{function m(c,r,M,S,d,b,C){try{var f=c[b](C),y=f.value}catch(D){return void M(D)}f.done?r(y):Promise.resolve(y).then(S,d)}function e(c){return function(){var r=this,M=arguments;return new Promise(function(S,d){var b=c.apply(r,M);function C(y){m(b,S,d,C,f,"next",y)}function f(y){m(b,S,d,C,f,"throw",y)}C(void 0)})}}l.d(E,{Z:()=>e})}}]);