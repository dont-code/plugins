(self.webpackChunkplugin_tester=self.webpackChunkplugin_tester||[]).push([[4044,5861],{44044:(q,j,d)=>{d.r(j),d.d(j,{BaseAppComponent:()=>Se,CHANNEL_CHANGE_NAME:()=>b,ChangeListenerService:()=>P,ChangeModule:()=>R,ChangeProviderService:()=>S,CommandModule:()=>V,DefaultViewerComponent:()=>A,DontCodeRuntimeConfig:()=>J,GlobalPluginLoader:()=>H,IdeProject:()=>ee,IndexedDbStorageService:()=>k,LayoutModule:()=>O,MainComponent:()=>ye,RemotePluginLoaderService:()=>U,SANDBOX_CONFIG:()=>v,SANDBOX_MENUS:()=>y,SandboxModule:()=>Ne,SharedModule:()=>T,basicDocumentApiUrlConfig:()=>_,basicStoreApiUrlConfig:()=>I});var h=d(57863),e=d(30549),u=d(92256),l=d(89785),E=d(4048),M=d(81738);const v=new e.InjectionToken("SandboxLibConfig"),I=o=>o.storeUrl,_=o=>o.documentUrl,b="preview-ui-changes",y=new e.InjectionToken("Allows addition of menus");var D=d(16602);let P=(()=>{var o;class s{constructor(t,n){this.http=t,this.config=n,this.listOfChanges=[],this.changeEmitter=new u.Subject,this.connectionStatus=new u.ReplaySubject(1),this.sessionId=null,this.sessionIdSubject=new u.ReplaySubject(1);try{this.config&&this.config.webSocketUrl&&this.config.webSocketUrl.length>0?(this.previewServiceWebSocket=(0,E.webSocket)(this.config.webSocketUrl),this.connectionStatus.next("connected"),this.previewServiceWebSocket.subscribe({next:i=>{i.type===l.MessageType.CHANGE&&(i.change?(this.listOfChanges.push(i.change),this.changeEmitter.next(i.change)):console.error("Received change message without a change..."))},error:i=>{this.connectionStatus.next("ERROR:"+i),this.sessionIdSubject.next(void 0)},complete:()=>{this.connectionStatus.next("closed"),this.sessionIdSubject.next(void 0)}})):(console.warn("No SANDBOX_CONFIG WebSocketUrl injected => Not listening to changes from servers"),this.connectionStatus.next("undefined"),this.sessionIdSubject.next(void 0)),this.config&&this.config.projectUrl&&this.config.projectUrl.length>0&&(this.projectUrl=this.config.projectUrl),this.channel=new M.BroadcastChannel(b,{}),this.channel.onmessage=i=>{this.listOfChanges.push(i),this.changeEmitter.next(i)}}catch(i){console.error("Error initializing ChangeListnerService",i)}}getListOfChanges(){return this.listOfChanges}getChangeEvents(){return this.changeEmitter}getConnectionStatus(){return this.connectionStatus}setSessionId(t){this.sessionId=t,this.sessionIdSubject.next(t||void 0),this.previewServiceWebSocket&&this.previewServiceWebSocket.next(new l.Message(l.MessageType.INIT,t||void 0))}loadProject(t){if(this.sessionId)throw new Error("Cannot load a project while in a session with Builder. Please load the project ");return this.projectUrl?(0,u.firstValueFrom)(this.http.get(this.projectUrl+"/"+encodeURIComponent(t),{responseType:"json"}).pipe((0,u.map)(n=>{const i=new l.Change(l.ChangeType.RESET,"",n.content);return this.listOfChanges.push(i),this.changeEmitter.next(i),n}))):Promise.reject(new Error("Cannot call project api as No projectUrl provided in SANDBOX_CONFIG"))}getSessionId(){return this.sessionId}getSessionIdSubject(){return this.sessionIdSubject}internalPushChange(t){return this.listOfChanges.push(t),this.changeEmitter.next(t),Promise.resolve()}}return(o=s).\u0275fac=function(t){return new(t||o)(e.\u0275\u0275inject(D.HttpClient),e.\u0275\u0275inject(v,8))},o.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"}),s})();var m=d(33272);let S=(()=>{var o;class s{constructor(t,n,i,a){this.changeListener=t,this.valueService=n,this.schemaManager=i,this.changeManager=a,this.subscriptions=new u.Subscription,this.changesHistory=new u.ReplaySubject,this.subscriptions.add(t.getChangeEvents().subscribe(c=>{this.pushChange(c)}))}getJsonAt(t){return this.changeManager.getJsonAt(t)}pushChange(t){this.changeManager.pushChange(t),this.changesHistory.next(t)}findAndNotify(t,n){this.changeManager.findAndNotify(t,n)}getChangesHistory(){return this.changesHistory}receiveCommands(t,n){return this.changeManager.receiveCommands(t,n)}getSchemaManager(){return this.schemaManager}calculatePointerFor(t){return this.schemaManager.generateSchemaPointer(t)}close(){this.subscriptions.unsubscribe()}}return(o=s).\u0275fac=function(t){return new(t||o)(e.\u0275\u0275inject(P),e.\u0275\u0275inject(m.ValueService),e.\u0275\u0275inject(l.DontCodeSchemaManager),e.\u0275\u0275inject(l.DontCodeChangeManager))},o.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"}),s})(),V=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=e.\u0275\u0275defineInjector({imports:[h.CommonModule]}),s})();class ee extends l.DontCodeProject{}let R=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=e.\u0275\u0275defineInjector({imports:[h.CommonModule]}),s})();var f=d(27022),N=d(49162);function te(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"p"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&o){const r=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2(" No handler found for position ",null==r.entityPointer?null:r.entityPointer.position," and schemaPosition ",null==r.entityPointer?null:r.entityPointer.positionInSchema," ")}}function ne(o,s){1&o&&e.\u0275\u0275elementContainer(0)}function oe(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ne,1,0,"ng-container",8),e.\u0275\u0275elementContainerEnd()),2&o){const r=e.\u0275\u0275nextContext().$implicit,t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngTemplateOutlet",t.subFieldFullEditTemplate(r))}}function ie(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"input",9),e.\u0275\u0275elementContainerEnd()),2&o){const r=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("name",r.name)("formControlName",r.name)}}function re(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",5)(1,"label",6),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",7),e.\u0275\u0275template(4,oe,2,1,"ng-container",0),e.\u0275\u0275template(5,ie,2,2,"ng-container",0),e.\u0275\u0275elementEnd()()),2&o){const r=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("for",r.name),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(r.name),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",r.component),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!r.component)}}function se(o,s){1&o&&e.\u0275\u0275elementContainer(0)}function ae(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,se,1,0,"ng-container",8),e.\u0275\u0275elementContainerEnd()),2&o){const r=e.\u0275\u0275nextContext().$implicit,t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngTemplateOutlet",t.subFieldInlineViewTemplate(r))}}function le(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1),e.\u0275\u0275elementContainerEnd()),2&o){const r=e.\u0275\u0275nextContext().$implicit,t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.getData(r.name))}}function ce(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275text(1),e.\u0275\u0275template(2,ae,2,1,"ng-container",0),e.\u0275\u0275template(3,le,2,1,"ng-container",0),e.\u0275\u0275elementEnd()),2&o){const r=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" Value of ",r.name,": "),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",r.component),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!r.component)}}function de(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"p"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"form",1)(4,"div",2),e.\u0275\u0275template(5,re,6,4,"div",3),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(8,ce,4,3,"div",4),e.\u0275\u0275elementContainerEnd()),2&o){const r=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("You can edit the ",r.entityName," entity:"),e.\u0275\u0275advance(1),e.\u0275\u0275property("formGroup",r.form),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",r.getSubFields()),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("The values of the ",r.entityName," entity are:"),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",r.getSubFields())}}let A=(()=>{var o;class s extends m.PluginBaseComponent{constructor(t,n,i,a,c){super(t,n,i),this.fb=a,this.storeMgr=c,this.entityName="Unknown",null==this.storeMgr&&(this.storeMgr=l.dtcde.getStoreManager(),console.warn("DontCodeStoreManager not found by Angular's Injector")),this.form=this.fb.group({},{updateOn:"blur"})}ngOnInit(){null==this.value&&(this.value={}),this.updateValueOnFormChanges()}initCommandFlow(t,n){super.initCommandFlow(t,n),this.isEntity()&&(this.decomposeJsonToMultipleChanges(n,t.getJsonAt(n.position)),this.store=this.storeMgr.getProvider(n.position),null!=this.store&&this.store.loadEntity(n.position,null).then(i=>{this.setValue(i),this.rebuildForm(),this.ref.detectChanges()},i=>{console.error("Cannot load element with DefaultViewer because of error ",i)}),this.initChangeListening(),this.rebuildForm()),this.ref.detectChanges()}handleChange(t){this.entityPointer&&(t?.pointer?.positionInSchema===l.DontCodeModel.APP_FIELDS?this.updateSubFieldsWithChange(t,"fields").then(n=>{null!=n&&(this.ref.markForCheck(),this.ref.detectChanges())}):"name"===t?.pointer?.isSubItemOf(this.entityPointer)&&(this.entityName=t.value,this.ref.markForCheck(),this.ref.detectChanges()))}canProvide(t){throw new Error("Unsupported")}providesTemplates(t){throw new Error("Unsupported")}isEntity(){return l.DontCodeModel.APP_ENTITIES===this.entityPointer?.positionInSchema}getData(t){if(this.form.controls[t])return this.form.controls[t].value}}return(o=s).\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(m.ComponentLoaderService),e.\u0275\u0275directiveInject(e.Injector),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(f.FormBuilder),e.\u0275\u0275directiveInject(l.DontCodeStoreManager))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["dontcode-sandbox-default-viewer"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:3,vars:2,consts:[[4,"ngIf"],[3,"formGroup"],[1,"p-fluid"],["class","p-field p-grid",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"p-field","p-grid"],[1,"p-col-12","p-mb-2","p-md-2","p-mb-md-0",3,"for"],[1,"p-col-12","p-md-10"],[4,"ngTemplateOutlet"],["pInputText","",3,"name","formControlName"]],template:function(t,n){1&t&&(e.\u0275\u0275element(0,"dtcde-dynamic"),e.\u0275\u0275template(1,te,3,2,"ng-container",0),e.\u0275\u0275template(2,de,9,5,"ng-container",0)),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n.isEntity()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.isEntity()))},dependencies:[h.NgForOf,h.NgIf,h.NgTemplateOutlet,m.DynamicInsertPoint,f.\u0275NgNoValidate,f.DefaultValueAccessor,f.NgControlStatus,f.NgControlStatusGroup,f.FormGroupDirective,f.FormControlName,N.InputText],changeDetection:0}),s})();var ue=d(83508),B=d.n(ue);let k=(()=>{var o;class s extends l.AbstractDontCodeStoreProvider{static forceCloseDatabase(){console.log("IndexedDB: In forceCloseDatabase"),null!=this.globalDb&&(console.log("IndexedDB: GlobalDB Exist"),this.globalDb.isOpen()&&(console.log("IndexedDB: Closing GlobalDB"),this.globalDb.close(),console.log("IndexedDB: GlobalDB is closed")))}static forceDeleteDatabase(t){return console.log("IndexedDB: In forceDeleteDatabase"),B().delete(t).then(()=>{console.log("IndexedDB: Database "+t+" deleted")})}constructor(t,n){super(),this.values=t,this.config=n,this.db=null,null==self._indexedDbStorageServiceForceClose&&(self._indexedDbStorageServiceForceClose=()=>s.forceCloseDatabase()),null==self._indexedDbStorageServiceForceDelete&&(self._indexedDbStorageServiceForceDelete=i=>s.forceDeleteDatabase(i))}deleteEntity(t,n){return this.ensurePositionCanBeStored(t,!1).then(i=>i.delete(n).then(()=>!0))}loadEntity(t,n){return this.ensurePositionCanBeStored(t,!1).then(i=>i.get(n)).catch(i=>{console.warn("IndexedDB: Cannot load entity "+n+" : "+i)})}searchEntities(t,...n){return(0,u.from)(this.ensurePositionCanBeStored(t,!1).then(i=>i.toArray().then(a=>l.StoreProviderHelper.applyFilters(a,...n))).catch(i=>(console.warn("IndexedDB: Cannot search entity: "+i),[])))}canStoreDocument(t){return!1}storeDocuments(t,n){throw new Error("Impossible to store documents in IndexedDB.")}storeEntity(t,n){return this.ensurePositionCanBeStored(t,!0).then(i=>i.put(n).then(a=>n._id&&n._id!==a?Promise.reject("Stored entity with id "+a+" different from "+n._id):n))}ensurePositionCanBeStored(t,n){const i=this.values.findAtPosition(t);return i?this.ensureEntityCanBeStored(i,n):Promise.reject("Error called with null description")}ensureEntityCanBeStored(t,n){return this.withDatabase().then(i=>{let a;try{a=i.table(t.name)}catch{}if(null!=a)return Promise.resolve(a);if(n){const c={};return c[t.name]="++_id",this.changeSchema(i,c).then(g=>g.table(t.name))}return Promise.reject(t.name+" table not found")})}changeSchema(t,n){return t.close(),t.version(t.verno+1).stores(n),t.open().then(i=>i)}withDatabase(){if(null==this.db){let t="Dont-code Sandbox Lib";if(this.config&&this.config.indexedDbName&&this.config.indexedDbName.length>0&&(t=this.config.indexedDbName),null==s.globalDb&&(s.globalDb=new(B())(t,{allowEmptyDB:!0,autoOpen:!1})),this.db=s.globalDb,!this.db.isOpen())return this.db.open().then(n=>n)}return Promise.resolve(this.db)}ngOnDestroy(){s.forceCloseDatabase()}allTables(t){let n="";for(const i of t.tables)n=n+", "+i.name;return n}}return(o=s).\u0275fac=function(t){return new(t||o)(e.\u0275\u0275inject(m.ValueService),e.\u0275\u0275inject(v,8))},o.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"}),s})();var F=d(15861),pe=d(93630);let U=(()=>{var o;class s{constructor(t,n,i){this.compLoader=t,this.injector=n,this.httpClient=i,this.repository=null}loadPluginsFromRepository(t,n){return void 0===t?Promise.resolve({name:"No Repository",plugins:[]}):(null==t&&(t=n),console.info("Loading plugins from repository url",t),(0,u.firstValueFrom)(this.httpClient.get(t,{observe:"body",responseType:"json"})).then(i=>{if(this.repository=i,null!=i.plugins){const a=new Array;return i.plugins.forEach(c=>{a.push(this.createRemotePluginConfig(c,n))}),console.debug("Loading following plugins",i.plugins),this.loadMultipleModules(a)}return Promise.resolve([])}).then(()=>null!=this.repository?this.repository:Promise.reject("No repository loaded")).catch(i=>(console.error("Cannot load repository config from "+t+" due to error ",i),t===n?Promise.reject(i):this.loadPluginsFromRepository(null,n))))}createRemotePluginConfig(t,n){let i;const a=t.id.substring(0,1).toUpperCase()+t.id.substring(1);return i=null!=t.info?{type:"module",moduleId:t.id,exposedModule:t.info["exposed-module"]??"./"+a,remoteEntry:t.info["remote-entry"]??n+"/remoteEntry.mjs"}:{type:"module",moduleId:t.id,exposedModule:"./"+a,remoteEntry:n+"/remoteEntry.mjs"},i}listAllRepositoryConfigUpdates(){const t=new Array;return this.repository?.plugins?.forEach(n=>{null!=n.config&&null!=n.config["definition-updates"]&&n.config["definition-updates"].forEach(i=>{t.push(i)})}),t}loadModule(t){var n=this;return(0,F.Z)(function*(){return yield(0,pe.loadRemoteModule)(t),(yield n.compLoader.getOrCreatePluginModuleRef(t.moduleId.toLowerCase())).instance})()}loadMultipleModules(t){var n=this;return(0,F.Z)(function*(){const i=new Array;for(const a of t)try{const c=yield n.loadModule(a);i.push(c)}catch(c){console.error("Error loading plugin "+a.moduleId,c)}return i})()}}return(o=s).\u0275fac=function(t){return new(t||o)(e.\u0275\u0275inject(m.ComponentLoaderService),e.\u0275\u0275inject(e.Injector),e.\u0275\u0275inject(D.HttpClient))},o.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"}),s})();var p=d(2369);let H=(()=>{var o;class s{constructor(t,n,i){this.loader=t,this.changeService=n,this.previewManager=i,this.subscribers=new u.Subscriber,this.cachedHandlers=new Map}initLoading(){this.subscribers.add(this.previewManager.receiveGlobalHandlers().pipe((0,p.mergeMap)(t=>this.loader.loadPluginModule(t).then(n=>({config:t,moduleRef:n}))),(0,p.mergeMap)(t=>{const n=t.moduleRef.instance.exposedPreviewHandlers().get(t.config.class.name);return this.changeService.receiveCommands(t.config.location.parent,t.config.location.id).pipe((0,p.map)(i=>({clazz:n,moduleRef:t.moduleRef,change:i})))}),(0,p.map)(t=>{let n=this.cachedHandlers.get(t.clazz);return n||(n=t.moduleRef.injector.get(t.clazz),this.cachedHandlers.set(t.clazz,n),n.initCommandFlow(this.changeService,t.change.pointer??this.changeService.calculatePointerFor(t.change.position)),n.handleChange(t.change)),n})).subscribe({error:t=>{console.error("Error loading global handler",t)}}))}close(){this.subscribers.unsubscribe()}}return(o=s).\u0275fac=function(t){return new(t||o)(e.\u0275\u0275inject(m.ComponentLoaderService),e.\u0275\u0275inject(S),e.\u0275\u0275inject(l.DontCodePreviewManager))},o.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"}),s})(),T=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=e.\u0275\u0275defineInjector({imports:[h.CommonModule,V,R,m.PluginCommonModule,f.ReactiveFormsModule,N.InputTextModule]}),s})();var x=d(84774),G=d(39366),z=d(42736),w=d(24504),W=d(56956),me=d(51411),$=d(69949),he=d(3134);let fe=(()=>{var o;class s{constructor(t,n,i,a,c){this.provider=t,this.ref=i,this.router=a,this.ngZone=c,this.templateMenus=new Array({label:"Main Menu",items:[{label:"Home",icon:"pi pi-home",routerLink:["/"]},{label:"Dev",icon:"pi pi-book",routerLink:["dev"]}]},{label:"Application Menu",items:new Array}),this.subscriptions=new u.Subscription,this.runtime=!1;const g=window.dontCodeConfig;(!0===g?.runtime||null!=g?.projectId)&&(this.runtime=!0),null!=n&&this.templateMenus[0].items.push(...n.additionalMenus()),this.menus=this.generateMenu()}ngOnInit(){this.handleItemMenu(l.DontCodeModel.APP_ENTITIES,l.DontCodeModel.APP_ENTITIES_NAME_NODE,"pi-ticket"),this.handleItemMenu(l.DontCodeModel.APP_SCREENS,l.DontCodeModel.APP_SCREENS_NAME_NODE,"pi-desktop"),this.handleItemMenu(l.DontCodeModel.APP_REPORTS,l.DontCodeModel.APP_REPORTS_TITLE_NODE,"pi-chart-pie")}handleItemMenu(t,n,i){this.subscriptions.add(this.provider.receiveCommands(t,n).pipe((0,p.map)(a=>{this.updateMenuName(a,i),this.ref.detectChanges()})).subscribe()),this.subscriptions.add(this.provider.receiveCommands(t+"/?").pipe((0,p.map)(a=>{a.position.length>t.length+1?(this.updateMenu(a,n,i),this.ref.detectChanges()):a.value||(this.getDynamicMenu().length=0,this.ref.detectChanges())})).subscribe())}getDynamicMenu(){return this.templateMenus[1].items?this.templateMenus[1].items:[]}generateMenu(){const t=new Array;return this.runtime?(this.getDynamicMenu().forEach(n=>{t.push(n)}),0===t.length&&t.push(this.templateMenus[1])):this.templateMenus.forEach(n=>{t.push(n)}),t}ngOnDestroy(){this.subscriptions.unsubscribe()}gotoPage(t){this.ngZone.run(()=>{this.router.navigate([t])})}isActive(t){return this.router.isActive(t,!0)}cleanPosition(t){return t.endsWith(l.DontCodeModel.APP_SCREENS_NAME_NODE)&&(t=t.substring(0,t.length-l.DontCodeModel.APP_SCREENS_NAME_NODE.length-1)),t}updateMenu(t,n,i){const a=t.position,c=this.findMenuPosOf(a);let g;if(-1===c){if(null==t.value?.[n])return;g={routerLink:[a],label:t.value[n],icon:"pi "+i}}else g=this.getDynamicMenu()[c];switch(t.type){case l.ChangeType.UPDATE:case l.ChangeType.RESET:case l.ChangeType.ADD:case l.ChangeType.DELETE:break;case l.ChangeType.MOVE:{-1!==c&&this.getDynamicMenu().splice(c,1);let C=-1;t.pointer&&(C=this.findMenuPosOf(t.pointer.containerPosition+"/"+t.beforeKey)),-1!==C?this.getDynamicMenu().splice(C,0,g):this.getDynamicMenu().push(g)}this.menus=this.generateMenu()}}updateMenuName(t,n){const i=l.DontCodeModelPointer.parentPosition(t.position);if(null==i)return void console.error("Cannot update menu name for "+t.position+" with no parent position");const a=this.cleanPosition(i),c=this.findMenuPosOf(a),g=t.value;let C;switch(C=-1===c?{routerLink:[a],label:t.value,icon:"pi "+n}:this.getDynamicMenu()[c],t.type){case l.ChangeType.UPDATE:case l.ChangeType.RESET:case l.ChangeType.ADD:-1!==c?C.label=g:this.getDynamicMenu().push(C);break;case l.ChangeType.DELETE:-1!==c&&this.getDynamicMenu().splice(c,1)}this.menus=this.generateMenu()}findMenuPosOf(t){let n=-1;return this.getDynamicMenu().forEach((i,a)=>{i.routerLink[0]===t&&(n=a)}),n}}return(o=s).\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(S),e.\u0275\u0275directiveInject(y,8),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(x.Router),e.\u0275\u0275directiveInject(e.NgZone))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["dontcode-sandbox-menu"]],decls:2,vars:1,consts:[[1,"grid"],[1,"col",3,"model"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"p-menu",1),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("model",n.menus))},dependencies:[W.Menu],changeDetection:0}),s})();function ge(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",14)(1,"div",18),e.\u0275\u0275text(2,"Server:"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",19),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",18),e.\u0275\u0275text(6,"Session:"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div",19),e.\u0275\u0275text(8),e.\u0275\u0275elementEnd()()),2&o){const r=e.\u0275\u0275nextContext().ngIf,t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(t.serverUrl),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(r.sessionId)}}const ve=function(){return{width:"500px"}},Ce=function(){return{width:"15em"}};function be(o,s){if(1&o){const r=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"p-toolbar",1)(2,"div",2)(3,"button",3),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(r);const n=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(n.sidePanelVisible=!n.sidePanelVisible)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"a",4),e.\u0275\u0275element(5,"img",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"h1"),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"div",6)(9,"button",7),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(r);const n=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(n.openDevUrl())}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"button",8),e.\u0275\u0275listener("mouseenter",function(n){e.\u0275\u0275restoreView(r);const i=e.\u0275\u0275reference(12);return e.\u0275\u0275resetView(i.show(n))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"p-overlayPanel",9,10),e.\u0275\u0275template(13,ge,9,2,"ng-template",11),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(14,"div",12)(15,"p-sidebar",13),e.\u0275\u0275listener("visibleChange",function(n){e.\u0275\u0275restoreView(r);const i=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(i.sidePanelVisible=n)}),e.\u0275\u0275elementStart(16,"a",4),e.\u0275\u0275element(17,"img",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(18,"dontcode-sandbox-menu"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(19,"div",14)(20,"div",15),e.\u0275\u0275element(21,"dontcode-sandbox-menu",16),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(22,"div",17),e.\u0275\u0275element(23,"router-outlet"),e.\u0275\u0275elementEnd()()()}if(2&o){const r=s.ngIf,t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(5),e.\u0275\u0275property("src",t.themedLogo(),e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.appName),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngClass",t.connectedClass(r)),e.\u0275\u0275advance(1),e.\u0275\u0275styleMap(e.\u0275\u0275pureFunction0(13,ve)),e.\u0275\u0275property("showCloseIcon",!1),e.\u0275\u0275advance(4),e.\u0275\u0275styleMap(e.\u0275\u0275pureFunction0(14,Ce)),e.\u0275\u0275property("visible",t.sidePanelVisible)("modal",!1)("closeOnEscape",!0)("showCloseIcon",!0),e.\u0275\u0275advance(2),e.\u0275\u0275property("src",t.themedLogo(),e.\u0275\u0275sanitizeUrl)}}let ye=(()=>{var o;class s{constructor(t,n,i,a){this.provider=t,this.listenerService=n,this.ref=i,this.config=a,this.context$=u.EMPTY,this.subscriptions=new u.Subscription,this.appName="Plugin Tester",this.serverUrl="",this.sidePanelVisible=!0}ngOnInit(){this.config?.applicationName&&(this.appName=this.config?.applicationName),this.config&&this.config.webSocketUrl&&this.config.webSocketUrl.length>0&&(this.serverUrl=this.config.webSocketUrl),this.subscriptions.add(this.provider.receiveCommands(l.DontCodeModel.APP_NAME).subscribe(t=>{this.appName=this.generateApplicationName(t.value?t.value:"No Name"),this.ref.detectChanges()})),this.context$=(0,u.combineLatest)([this.listenerService.getConnectionStatus(),this.listenerService.getSessionIdSubject()]).pipe((0,p.map)(t=>({status:t[0],sessionId:t[1]})))}ngOnDestroy(){this.subscriptions.unsubscribe()}logoClicked(){this.sidePanelVisible=!0}sidePanelVisibleChanged(t){this.sidePanelVisible=t.target.visible}openDevUrl(){window.open("#/newTabDev","_blank")}connectedClass(t){return"undefined"===t.status?"p-button-secondary":"connected"!==t.status?"p-button-danger":""}generateApplicationName(t){return this.config?.applicationName?this.config?.applicationName+" "+t:t}themedLogo(){return this.config?.theme?"assets/images/logo-"+this.config?.theme+".png":"assets/images/logo.png"}}return(o=s).\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(S),e.\u0275\u0275directiveInject(P),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(v,8))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["dontcode-sandbox-main"]],decls:2,vars:3,consts:[[4,"ngIf"],["id","mainToolbar"],[1,"p-toolbar-group-left"],["pButton","","type","button","icon","pi pi-bars",1,"md:hidden","p-button-rounded","p-button-outlined",2,"margin-right","10px",3,"click"],["href","https://dont-code.net/apps.html"],["width","119","height","66",3,"src"],[1,"p-toolbar-group-right"],["pButton","","type","button","icon","pi pi-external-link",1,"p-button-rounded","p-button-outlined",3,"click"],["pButton","","type","button","icon","pi pi-sort",1,"p-button-rounded","p-button-outlined",3,"ngClass","mouseenter"],[3,"showCloseIcon"],["op",""],["pTemplate",""],[1,"md:hidden"],["id","mainSidePanel",3,"visible","modal","closeOnEscape","showCloseIcon","visibleChange"],[1,"grid"],[1,"col","hidden","md:block","md:col-3"],["id","mainMenu"],[1,"col","md:col-9"],[1,"col-2"],[1,"col-10"]],template:function(t,n){1&t&&(e.\u0275\u0275template(0,be,24,15,"div",0),e.\u0275\u0275pipe(1,"async")),2&t&&e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(1,1,n.context$))},dependencies:[h.NgClass,h.NgIf,x.RouterOutlet,G.Sidebar,he.PrimeTemplate,z.Toolbar,w.ButtonDirective,$.OverlayPanel,fe,h.AsyncPipe],styles:[".sidenav-container[_ngcontent-%COMP%]{height:100%}.sidenav[_ngcontent-%COMP%]{width:200px}.sidenav[_ngcontent-%COMP%]   .mat-toolbar[_ngcontent-%COMP%]{background:inherit}.mat-toolbar.mat-primary[_ngcontent-%COMP%]{position:sticky;top:0;z-index:1}"],changeDetection:0}),s})(),Se=(()=>{var o;class s{constructor(t,n,i,a,c,g,C,Ae,Fe,Oe,Le,Ve){this.provider=t,this.storage=n,this.listener=i,this.pluginLoader=a,this.globalPluginLoader=c,this.loaderService=g,this.changeProviderService=C,this.injector=Ae,this.dontCodeCore=Fe,this.modelMgr=Oe,this.storeMgr=Le,this.previewMgr=Ve,this.subscription=new u.Subscription,this.sessionId=null,this.runtimeConfig=new J}ngOnInit(){this.pluginsLoaded=this.pluginLoader.loadPluginsFromRepository(this.runtimeConfig.repositoryUrl,"assets/repositories/default.json").catch(n=>this.runtimeConfig.forceRepositoryLoading?Promise.reject(n):Promise.resolve(null)).then(n=>{this.dontCodeCore.initPlugins(),this.pluginLoader.listAllRepositoryConfigUpdates().forEach(a=>{const c=this.modelMgr.convertToChange(a);this.changeProviderService.pushChange(c)}),console.info("Dynamic Plugins inited"),this.globalPluginLoader.initLoading(),this.storeMgr.setProvider(this.storage),this.subscription.add(this.provider.receiveCommands(l.DontCodeModel.APP_SHARING,l.DontCodeModel.APP_SHARING_WITH_NODE).pipe((0,p.mergeMap)(a=>a.type!==l.ChangeType.DELETE?"No-one"===a.value?(this.storeMgr.setProvider(this.storage),u.EMPTY):a.value?this.loadStoreManager(l.DontCodeModel.APP_SHARING_WITH):u.EMPTY:u.EMPTY),(0,p.map)(a=>{if(null!=a){const c=e.Injector.create({providers:[a],parent:this.injector});this.storeMgr.setProvider(c.get(a)),console.info("Set new provider to:",a)}return a})).subscribe({error(a){console.error("Cannot load StoreProvider due to",a)}})),this.sessionId=this.runtimeConfig.sessionId??null,console.info("Browser opened with SessionId =",this.sessionId),this.listener.setSessionId(this.sessionId)})}loadStoreManager(t){const n=this.provider.getJsonAt(t),i=this.previewMgr.retrieveHandlerConfig(t,n);return i?(console.debug("Importing StoreManager from ",i.class.source),this.loaderService.loadPluginModule(i).then(a=>{const c=a.instance.exposedPreviewHandlers().get(i.class.name);return console.debug("Provider Class found:",c),c})):Promise.reject("No handler found for storemanager "+n)}mainTab(){return-1===window.location.hash.indexOf("/newTabDev")}ngOnDestroy(){this.subscription.unsubscribe()}}return(o=s).\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(S),e.\u0275\u0275directiveInject(k),e.\u0275\u0275directiveInject(P),e.\u0275\u0275directiveInject(U),e.\u0275\u0275directiveInject(H),e.\u0275\u0275directiveInject(m.ComponentLoaderService),e.\u0275\u0275directiveInject(S),e.\u0275\u0275directiveInject(e.Injector),e.\u0275\u0275directiveInject(m.DONT_CODE_CORE),e.\u0275\u0275directiveInject(l.DontCodeModelManager),e.\u0275\u0275directiveInject(l.DontCodeStoreManager),e.\u0275\u0275directiveInject(l.DontCodePreviewManager))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ng-component"]],decls:0,vars:0,template:function(t,n){},encapsulation:2}),s})();class J{constructor(){this.runtime=!1,this.forceRepositoryLoading=!1}}let O=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=e.\u0275\u0275defineInjector({imports:[h.CommonModule,x.RouterModule,G.SidebarModule,z.ToolbarModule,w.ButtonModule,W.MenuModule,me.TooltipModule,$.OverlayPanelModule]}),s})();var L=d(37981),Y=d(7471),Me=d(97822),Z=d(30178),X=d(46674);let _e=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=e.\u0275\u0275defineInjector({imports:[h.CommonModule,T,L.AccordionModule,Y.AutoCompleteModule,Me.PanelModule,N.InputTextModule,f.ReactiveFormsModule,Z.InputTextareaModule,w.ButtonModule,X.DropdownModule,m.PluginCommonModule]}),s})(),Ie=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["dontcode-sandbox-home"]],decls:24,vars:0,consts:[["pButton","","type","button","icon","pi pi-sort",1,"p-button-rounded","p-button-outlined","p-button-secondary"],["pButton","","type","button","icon","pi pi-sort",1,"p-button-rounded","p-button-outlined","p-button-danger"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"h1"),e.\u0275\u0275text(1,"Welcome to DontCode !"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(2,"h2"),e.\u0275\u0275text(3,"What am I seeing ?"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"p"),e.\u0275\u0275text(5,"You have opened the Preview App. The Preview App connects to Online services to receive Application changes from the Application Builder in realtime."),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p")(7,"b"),e.\u0275\u0275text(8,"Check you are connected"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(9," to the online service by looking at the "),e.\u0275\u0275element(10,"button",0),e.\u0275\u0275text(11," icon in the header panel."),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"p"),e.\u0275\u0275element(13,"button",0),e.\u0275\u0275text(14," means you are ok, "),e.\u0275\u0275element(15,"button",1),e.\u0275\u0275text(16," you have connection issue to the online service. Please check the browser log in this case"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"p"),e.\u0275\u0275text(18,"If "),e.\u0275\u0275element(19,"button",0),e.\u0275\u0275text(20,", then "),e.\u0275\u0275elementStart(21,"b"),e.\u0275\u0275text(22,"go back to the Application Builder"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(23," and enter some values in the Editor"),e.\u0275\u0275elementEnd())},dependencies:[w.ButtonDirective],styles:["button[_ngcontent-%COMP%]{vertical-align:middle}"]}),s})();function Ee(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"p"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"json"),e.\u0275\u0275elementEnd()),2&o){const r=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate3("",r.type,", ",r.position,", ",e.\u0275\u0275pipeBind1(2,3,r.value?r.value:r.beforeKey),"")}}let De=(()=>{var o;class s{constructor(t,n){this.changeProvider=t,this.ref=n,this.subscriptions=new u.Subscription,this.commands=[],this.forgetIt=!0}ngOnInit(){this.subscriptions.add(this.changeProvider.getChangesHistory().pipe((0,p.map)(t=>{this.commands.push(t),this.ref.detectChanges()})).subscribe())}noCommands(){return 0==this.commands.length}ngOnDestroy(){this.subscriptions.unsubscribe()}}return(o=s).\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(S),e.\u0275\u0275directiveInject(e.ChangeDetectorRef))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["dontcode-sandbox-list-commands"]],decls:3,vars:1,consts:[[4,"ngFor","ngForOf"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"p"),e.\u0275\u0275text(1,"We list below the commands received from the Application Builder:"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(2,Ee,3,5,"p",0)),2&t&&(e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",n.commands))},dependencies:[h.NgForOf,h.JsonPipe],changeDetection:0}),s})(),Pe=(()=>{var o;class s{constructor(t){this.listener=t,this.channel=new M.BroadcastChannel(b)}pushChange(t){return this.listener.internalPushChange(t)}}return(o=s).\u0275fac=function(t){return new(t||o)(e.\u0275\u0275inject(P))},o.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"}),s})(),xe=(()=>{var o;class s{constructor(t,n){this.http=t,this.config=n,this.templates=[]}getTemplates(){if(this.templates.length>0)return(0,u.of)(this.templates);{let t=this.config?.templateFileUrl;return t||(t="assets/dev/default-templates.json"),this.http.get(t,{responseType:"json"}).pipe((0,p.map)(n=>(this.templates=new Array,n.forEach(a=>{this.templates.push(new we(a))}),this.templates)),(0,p.catchError)(n=>{throw console.log("Error reading Dev templates file",n),n}))}}filterTemplates(t){return t=t.toLowerCase(),this.getTemplates().pipe((0,p.map)(n=>n.filter(a=>!!a.name.toLowerCase().startsWith(t))))}}return(o=s).\u0275fac=function(t){return new(t||o)(e.\u0275\u0275inject(D.HttpClient),e.\u0275\u0275inject(v,8))},o.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"}),s})();class we{constructor(s){if(this.name=s.name,this.sequence=[],void 0!==s.position)this.sequence.push(new Q(s.position,s.type,s.value));else for(const r of s.sequence)this.sequence.push(new Q(r.position,r.type,r.value))}isSequence(){return!!this.sequence&&this.sequence.length>1}}class Q{constructor(s,r,t){this.position=s,this.type=r,this.value=t}isValid(){return null!=this.position&&null!=this.type}}let je=(()=>{var o;class s{constructor(t,n,i){this.pushService=t,this.templates=n,this.fb=i,this.position="creation/name",this.value="New Test",this.subscriptions=new u.Subscription,this.listTemplates=[],this.filteredTemplates=[],this.templateForm=this.fb.group({template:null,step:null,type:null,value:null}),this.filteredSteps=[],this.selectedStep=null,this.valueFieldLabel="Value",this.changeTypes=[{label:l.ChangeType.ADD},{label:l.ChangeType.UPDATE},{label:l.ChangeType.DELETE},{label:l.ChangeType.MOVE},{label:l.ChangeType.RESET}],this.openAddCommand=!0}ngOnInit(){this.subscriptions.add(this.templates.getTemplates().pipe((0,p.map)(t=>{this.listTemplates=t})).subscribe()),this.subscriptions.add(this.templateForm.get("template")?.valueChanges.pipe((0,p.map)(t=>{const n=this.templateForm.get("step"),i=this.templateForm.get("type");if(null==n||null==i)throw new Error("Cannot find value and type field");null!=t?(this.filteredSteps=t.sequence,n.setValue(t.sequence[0]),n.enable({emitEvent:!1}),i.setValue(t.sequence[0].type)):(n.setValue(null),n.disable({emitEvent:!1}),i.setValue(null))})).subscribe()),this.subscriptions.add(this.templateForm.get("step")?.valueChanges.pipe((0,p.map)(t=>{const n=this.templateForm.get("value"),i=this.templateForm.get("type");if(null==n||null==i)throw new Error("Cannot find value and type field");null===t?(n.disable({emitEvent:!1}),i.disable({emitEvent:!1})):(n.enable({emitEvent:!1}),i.enable({emitEvent:!1})),"string"==typeof t?(this.templateForm.get("template")?.setValue(null,{emitEvent:!1}),null!=this.selectedStep&&(this.selectedStep.position=t)):(this.selectedStep=t,null!=t&&(i.setValue(t.type),n.setValue("string"==typeof t.value?t.value:JSON.stringify(t.value,null,2))))})).subscribe()),this.subscriptions.add(this.templateForm.get("value")?.valueChanges.pipe((0,p.map)(t=>{const n=this.getSelectedStep();if(null!=n)if(null==t)n.value=t;else try{n.value=JSON.parse(t)}catch{n.value=t}})).subscribe()),this.subscriptions.add(this.templateForm.get("type")?.valueChanges.pipe((0,p.map)(t=>{const n=this.getSelectedStep();null!=n&&(n.type=t??""),this.valueFieldLabel=t===l.ChangeType.MOVE?"Before":"Value"})).subscribe())}ngOnDestroy(){this.subscriptions.unsubscribe()}sendCommand(){var t=this;return(0,F.Z)(function*(){const n=t.getSelectedTemplate();if(null!=n)for(const i of n.sequence)i.isValid()&&(yield t.pushChange(i.type,i.position,i.value));else{const i=t.getSelectedStep();null!=i&&i.isValid()&&(yield t.pushChange(i.type,i.position,i.value))}})()}searchTemplate(t){this.subscriptions.add(this.templates.filterTemplates(t.query).pipe((0,p.map)(n=>{this.filteredTemplates=n})).subscribe())}getSelectedTemplate(){return this.templateForm.get("template")?.value??null}getSelectedStep(){return this.selectedStep}searchStep(t){const n=t.query.toLowerCase(),i=this.getSelectedTemplate()?.sequence;this.filteredSteps=i?i.filter(a=>!!a.position.toLowerCase().startsWith(n)):[]}pushChange(t,n,i){"/"===n&&(n="");const a=new l.Change(l.ChangeType[t],n,i);return t===l.ChangeType.MOVE&&(a.value=null,a.oldPosition=n,a.beforeKey=i),this.pushService.pushChange(a)}}return(o=s).\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(Pe),e.\u0275\u0275directiveInject(xe),e.\u0275\u0275directiveInject(f.FormBuilder))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["dontcode-sandbox-insert-command"]],decls:26,vars:9,consts:[["header","Add Command",3,"selected"],[1,"p-fluid","formgrid","grid",3,"formGroup"],[1,"field","col-12","md:col-9"],[1,"p-float-label"],["id","template","formControlName","template","field","name",3,"suggestions","dropdown","completeMethod"],["for","template"],[1,"field","col-12","md:col-3"],["id","sendButton","label","Send",3,"click"],["id","step","formControlName","step","field","position",3,"suggestions","dropdown","completeMethod"],["for","step"],["id","type","formControlName","type","field","type","optionValue","label",3,"options"],["for","type"],[1,"field","col-12"],["pInputTextarea","","id","value","formControlName","value","field","value","rows","10",3,"autoResize"],["for","value"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"p-accordion")(1,"p-accordionTab",0)(2,"div",1)(3,"div",2)(4,"span",3)(5,"p-autoComplete",4),e.\u0275\u0275listener("completeMethod",function(a){return n.searchTemplate(a)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"label",5),e.\u0275\u0275text(7,"Select a Template"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(8,"div",6)(9,"p-button",7),e.\u0275\u0275listener("click",function(){return n.sendCommand()}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(10,"div",2)(11,"span",3)(12,"p-autoComplete",8),e.\u0275\u0275listener("completeMethod",function(a){return n.searchStep(a)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"label",9),e.\u0275\u0275text(14,"Step"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(15,"div",6)(16,"span",3),e.\u0275\u0275element(17,"p-dropdown",10),e.\u0275\u0275elementStart(18,"label",11),e.\u0275\u0275text(19,"Select a type"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(20,"div",12)(21,"span",3)(22,"textarea",13),e.\u0275\u0275text(23,"          "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(24,"label",14),e.\u0275\u0275text(25),e.\u0275\u0275elementEnd()()()()()()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("selected",n.openAddCommand),e.\u0275\u0275advance(1),e.\u0275\u0275property("formGroup",n.templateForm),e.\u0275\u0275advance(3),e.\u0275\u0275property("suggestions",n.filteredTemplates)("dropdown",!0),e.\u0275\u0275advance(7),e.\u0275\u0275property("suggestions",n.filteredSteps)("dropdown",!0),e.\u0275\u0275advance(5),e.\u0275\u0275property("options",n.changeTypes),e.\u0275\u0275advance(5),e.\u0275\u0275property("autoResize",!0),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(n.valueFieldLabel))},dependencies:[L.Accordion,L.AccordionTab,Y.AutoComplete,f.DefaultValueAccessor,f.NgControlStatus,f.NgControlStatusGroup,f.FormGroupDirective,f.FormControlName,Z.InputTextarea,w.Button,X.Dropdown]}),s})(),K=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["dontcode-sandbox-debug-page"]],decls:12,vars:0,consts:[[1,"grid","flex-column"],[1,"col"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"h1"),e.\u0275\u0275text(3,"Debug Page"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"br"),e.\u0275\u0275text(5,"This page allows us to test your plugin by injecting the same commands than the Builder application. "),e.\u0275\u0275element(6,"br"),e.\u0275\u0275text(7,"You then can see the behavior of your Preview Plugin without running the Builder "),e.\u0275\u0275element(8,"br"),e.\u0275\u0275text(9," Please select the command to add: "),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(10,"dontcode-sandbox-insert-command",1)(11,"dontcode-sandbox-list-commands",1),e.\u0275\u0275elementEnd())},dependencies:[De,je]}),s})();const Te=[{path:"",component:Ie},{path:"dev",component:K},{path:"newTabDev",component:K},{path:"creation/:type/:id",component:(()=>{var o;class s{constructor(t,n,i,a){this.route=t,this.provider=n,this.loader=i,this.injector=a,this.subscriptions=new u.Subscription,this.screenName$=u.EMPTY}ngOnInit(){this.screenName$=this.route.params}ngOnDestroy(){this.subscriptions.unsubscribe()}ngAfterViewInit(){this.subscriptions.add(this.route.url.pipe((0,p.map)(t=>{let n=null;if(t.forEach(i=>{n=null===n?i.path:n+"/"+i.path}),null==n)throw new Error("No position in route to screen");if(null==this.provider)throw new Error("No provider");try{const i=this.provider.calculatePointerFor(n);this.dynamicInsertPoint.clear(),this.loader.insertComponent(i,this.dynamicInsertPoint,this.provider.getJsonAt(n)).then(a=>{null==a&&this.loader.createComponent(A,this.dynamicInsertPoint,void 0,i)})}catch(i){console.warn("Error creating component for "+n+":",i),this.loader.createComponent(A,this.dynamicInsertPoint,void 0,new l.DontCodeModelPointer(n,n))}})).subscribe())}providesTemplates(t){throw new Error("Method not implemented.")}canProvide(t){throw new Error("Method not implemented.")}}return(o=s).\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(x.ActivatedRoute),e.\u0275\u0275directiveInject(S),e.\u0275\u0275directiveInject(m.ComponentLoaderService),e.\u0275\u0275directiveInject(e.Injector))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["dontcode-sandbox-screen"]],viewQuery:function(t,n){if(1&t&&e.\u0275\u0275viewQuery(m.DynamicInsertPoint,5,e.ViewContainerRef),2&t){let i;e.\u0275\u0275queryRefresh(i=e.\u0275\u0275loadQuery())&&(n.dynamicInsertPoint=i.first)}},decls:1,vars:0,template:function(t,n){1&t&&e.\u0275\u0275element(0,"dtcde-dynamic")},dependencies:[m.DynamicInsertPoint]}),s})()}];let Ne=(()=>{var o;class s{static forRoot(t){return{ngModule:s,providers:[{provide:v,useValue:t},{provide:m.DONT_CODE_STORE_API_URL,useValue:t.storeUrl},{provide:m.DONT_CODE_DOC_API_URL,useValue:t.documentUrl}]}}}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=e.\u0275\u0275defineInjector({providers:[{provide:m.COMMAND_PROVIDER,useExisting:S}],imports:[T,O,_e,x.RouterModule.forChild(Te),T,O]}),s})()},15861:(q,j,d)=>{function h(u,l,E,M,v,I,_){try{var b=u[I](_),y=b.value}catch(D){return void E(D)}b.done?l(y):Promise.resolve(y).then(M,v)}function e(u){return function(){var l=this,E=arguments;return new Promise(function(M,v){var I=u.apply(l,E);function _(y){h(I,M,v,_,b,"next",y)}function b(y){h(I,M,v,_,b,"throw",y)}_(void 0)})}}d.d(j,{Z:()=>e})}}]);